<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fitness | Tu Entrenador Inteligente</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Fuente Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">


    <!-- CSS personalizado -->
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0a0a0a;
            color: #e5e7eb;
            overflow-x: hidden;
        }

        /* Navbar */
        .navbar {
            background-color: #111827;
        }

        .navbar-brand {
            color: #3b82f6 !important;
            font-weight: 700;
            letter-spacing: 1px;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(to right, rgba(0,0,0,0.8), rgba(37,99,235,0.3)), 
                        url('https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
        }

        .hero h1 {
            font-weight: 700;
            font-size: 3rem;
        }

        .hero p {
            font-size: 1.2rem;
            color: #cbd5e1;
        }

        /* Formulario */
        .form-container {
            background-color: #111827;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 0 20px rgba(59,130,246,0.3);
            margin-top: -5rem;
        }

        label {
            font-weight: 600;
            color: #e5e7eb;
        }

        .btn-primary {
            background-color: #2563eb;
            border: none;
            transition: 0.3s;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        /* Footer */
        footer {
            background-color: #111827;
            color: #9ca3af;
            padding: 1rem 0;
            text-align: center;
        }

        @media (max-width: 768px) {
            .hero h1 { font-size: 2rem; }
            .hero p { font-size: 1rem; }
        }
    </style>
</head>

<!-- Chatbot simple flotante -->
<!-- BOTÓN FLOTANTE DE CHAT -->
<div id="chatbot-toggle">
  💬
</div>

<!-- CONTENEDOR DEL CHATBOT -->
<div id="chatbot-container" class="hidden">
  <div id="chatbox">
    <div id="chat-header">
      🤖 Coach AI Fitness
      <span id="closeChat" style="float:right; cursor:pointer;">—</span>
    </div>
    <div id="chat-messages"></div>
    <div id="chat-input">
      <input type="text" id="userInput" placeholder="Escribe tu pregunta..." />
      <button id="sendBtn">Enviar</button>
    </div>
  </div>
</div>

<!-- ==== ESTILOS ==== -->
<style>
/* Botón flotante */
#chatbot-toggle {
  position: fixed;
  bottom: 25px;
  right: 25px;
  background-color: #3b82f6;
  color: white;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  cursor: pointer;
  box-shadow: 0 0 20px rgba(37, 99, 235, 0.4);
  z-index: 9998;
  transition: all 0.3s ease;
}
#chatbot-toggle:hover {
  background-color: #2563eb;
  transform: scale(1.05);
}

/* Chat container */
#chatbot-container {
  position: fixed;
  bottom: 90px;
  right: 25px;
  z-index: 9999;
  transition: opacity 0.3s ease, transform 0.3s ease;
}
.hidden {
  display: none;
}

#chatbox {
  width: 320px;
  background-color: #111827;
  border: 2px solid #3b82f6;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 0 20px rgba(37,99,235,0.3);
}

#chat-header {
  background-color: #3b82f6;
  color: white;
  text-align: center;
  padding: 10px;
  font-weight: 600;
  font-size: 1rem;
}

#chat-messages {
  height: 300px;
  overflow-y: auto;
  padding: 10px;
  color: #e5e7eb;
  font-size: 0.9rem;
}

#chat-input {
  display: flex;
  border-top: 1px solid #1f2937;
}
#chat-input input {
  flex: 1;
  padding: 10px;
  border: none;
  background-color: #0f172a;
  color: #e5e7eb;
}
#chat-input button {
  background-color: #3b82f6;
  border: none;
  color: white;
  padding: 10px 15px;
  cursor: pointer;
}
#chat-input button:hover {
  background-color: #2563eb;
}
</style>

<!-- ==== SCRIPT ==== -->
<script>
const messages = document.getElementById("chat-messages");
const input = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
const chatbot = document.getElementById("chatbot-container");
const toggleBtn = document.getElementById("chatbot-toggle");
const closeChat = document.getElementById("closeChat");

// Mostrar / ocultar chatbot
toggleBtn.addEventListener("click", () => {
  chatbot.classList.toggle("hidden");
});

// Cerrar desde encabezado
closeChat.addEventListener("click", () => {
  chatbot.classList.add("hidden");
});

// Enviar mensajes
function appendMessage(sender, text) {
  const msg = document.createElement("div");
  msg.classList.add("message");
  msg.style.marginBottom = "8px";
  msg.innerHTML = `<strong>${sender}:</strong> ${text}`;
  messages.appendChild(msg);
  messages.scrollTop = messages.scrollHeight;
}

function generateResponse(userMsg) {
  userMsg = userMsg.toLowerCase();

  if (userMsg.includes("hola")) return "¡Hola! 👋 Soy tu Coach AI Fitness. ¿En qué puedo ayudarte hoy?";
  if (userMsg.includes("alimentación") || userMsg.includes("comer"))
    return "🍎 Te recomiendo alimentos ricos en proteínas y carbohidratos complejos antes del entrenamiento.";
  if (userMsg.includes("rutina") || userMsg.includes("ejercicio"))
    return "🏋️‍♂️ Puedes revisar tu rutina personalizada en el Dashboard. ¡Recuerda calentar antes de entrenar!";
  if (userMsg.includes("motivación"))
    return "🔥 La constancia vence al talento. ¡Hoy es un gran día para entrenar!";
  if (userMsg.includes("gracias"))
    return "💪 ¡Siempre aquí para ayudarte! Sigue con tu plan.";
  if (userMsg.includes("contacto"))
    return "📩 Puedes dejar tu duda y te contactaremos desde el portal principal.";

  return "🤖 No estoy seguro de eso, pero puedo ayudarte con alimentación, rutinas o motivación.";
}

// Enviar respuesta
sendBtn.addEventListener("click", () => {
  const userMsg = input.value.trim();
  if (!userMsg) return;

  appendMessage("Tú", userMsg);
  input.value = "";

  setTimeout(() => {
    const aiResponse = generateResponse(userMsg);
    appendMessage("Coach AI", aiResponse);
  }, 500);
});
</script>




<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/">AI Fitness</a>
            <div class="d-flex">
                <a href="/dashboard" class="btn btn-outline-light btn-sm me-2">Dashboard</a>
                <a href="/plan" class="btn btn-primary btn-sm">Mi Plan</a>
                <a href="/nutrition" class="btn btn-outline-light btn-sm me-2">Nutrición</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container text-center">
            <h1>Tu Entrenador Inteligente</h1>
            <p>Genera tu plan personalizado de alimentación y entrenamiento con IA.</p>
            <a href="#form-section" class="btn btn-primary mt-3 px-4 py-2">Comenzar Ahora</a>
        </div>
    </section>

 <!-- Sección Formulario con Imagen Lateral -->
<section id="form-section" class="container my-5">
    <div class="row align-items-center justify-content-center form-container mx-auto" style="max-width: 900px;">
        
        <!-- Columna Imagen -->
        <div class="col-md-6 d-none d-md-block">
            <img src="https://images.unsplash.com/photo-1605296867304-46d5465a13f1?auto=format&fit=crop&w=900&q=80"
                 alt="Entrenamiento Fitness" 
                 class="img-fluid rounded shadow">
        </div>

        <!-- Columna Formulario -->
        <div class="col-md-6 px-4 py-4">
            <h2 class="text-center text-light mb-4">Genera tu Plan</h2>
            
            <form id="planForm">
                <div class="mb-3">
                    <label for="userId" class="form-label">ID de Usuario</label>
                    <input type="text" class="form-control" id="userId" placeholder="Ej. usr_001" required>
                </div>

                <div class="mb-3">
                    <label for="weight" class="form-label">Peso (kg)</label>
                    <input type="number" class="form-control" id="weight" required>
                </div>

                <div class="mb-3">
                    <label for="goal" class="form-label">Objetivo</label>
                    <select class="form-select" id="goal" required>
                        <option value="">Selecciona...</option>
                        <option value="gain_muscle">Ganar músculo</option>
                        <option value="lose_fat">Perder grasa</option>
                        <option value="maintain">Mantener</option>
                    </select>
                </div>

                <div class="text-center">
                    <button type="submit" class="btn btn-primary px-4">Generar Plan</button>
                </div>

                <!-- Loader visual -->
                <div id="loading" class="text-center mt-4" style="display:none;">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                  </div>
                  <p class="text-light mt-2">Generando tu plan personalizado...</p>
                </div>

                <!-- Contenedor del resultado -->
                <div id="result"></div>
            </form>
        </div>
    </div>
</section>




    <!-- Footer -->
    <footer>
        <p>© 2025 AI Fitness | Desarrollado por Ismael Villegas</p>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Script para conectar con Flask y mostrar resultados -->
<script>
const loading = document.getElementById("loading");
const container = document.getElementById("result");
const form = document.getElementById("planForm");

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  container.innerHTML = "";
  loading.style.display = "block";

  const data = {
    _id: document.getElementById("userId").value,
    weight_kg: parseFloat(document.getElementById("weight").value),
    goal: document.getElementById("goal").value
  };

  try {
    const response = await fetch("/generate_plan", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const result = await response.json();
    loading.style.display = "none";

    if (response.status === 201) {
      container.innerHTML = `
        <div class="card mt-4 bg-dark text-light shadow p-4">
          <h4 class="text-primary fw-bold">✅ Plan generado con éxito</h4>
          <p><strong>Calorías/día:</strong> ${result.nutrition_plan.calories_per_day.toFixed(0)}</p>
          <p><strong>Proteínas:</strong> ${result.nutrition_plan.macros.protein.toFixed(1)} g</p>
          <p><strong>Carbohidratos:</strong> ${result.nutrition_plan.macros.carbs.toFixed(1)} g</p>
          <p><strong>Grasas:</strong> ${result.nutrition_plan.macros.fat.toFixed(1)} g</p>
          <p><strong>Rutina:</strong> ${result.training_plan.routines.join(", ")}</p>
        </div>`;
    } else {
      container.innerHTML = `
        <div class="alert alert-danger mt-4">
          ❌ ${result.error || "Ocurrió un error al generar el plan."}
        </div>`;
    }
  } catch (err) {
    loading.style.display = "none";
    container.innerHTML = `<div class="alert alert-danger mt-4">❌ Error de conexión con el servidor.</div>`;
  }
});
</script>
    
<script>
// Recuperar ID almacenado
const uidInput = document.getElementById("userId");
const savedUid = localStorage.getItem("ai_fitness_uid");
if (savedUid) uidInput.value = savedUid;

// Guardar al enviar el formulario
form.addEventListener("submit", () => {
  localStorage.setItem("ai_fitness_uid", uidInput.value);
});
</script>

</body>
</html>
