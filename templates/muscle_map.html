{% extends 'layout.html' %}

{% block title %}AI Fitness - Mapa Muscular{% endblock %}

{% block sidebar %}
{% include 'components/sidebar.html' %}
{% endblock %}

{% block content %}
<div class="row align-items-center mb-4">
    <div class="col-lg-8">
        <h2 class="fw-bold text-cyber-green mb-1"><i class="fas fa-project-diagram me-2"></i>Mapa Muscular</h2>
        <p class="text-secondary mb-2">Selecciona un músculo para ver información rápida y enfocarte en el grupo.</p>
        <div class="d-flex flex-wrap gap-1 mb-2">
            <div class="info-pill"><i class="fas fa-mouse-pointer me-1"></i>Click</div>
            <div class="info-pill active-pill"><i class="fas fa-highlighter me-1"></i>Activo</div>
            <div class="info-pill hover-pill"><i class="fas fa-wave-square me-1"></i>Hover</div>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-lg-10 col-xl-8 mx-auto">
        <div class="card bg-panel border-0 shadow-sm h-100">
            <div
                class="card-header border-secondary text-white fw-bold d-flex flex-wrap align-items-center justify-content-between gap-2">
                <div class="d-flex align-items-center gap-2">
                    <i class="fas fa-map text-cyber-blue"></i>
                    Mapa muscular
                </div>
                <ul class="nav nav-tabs nav-tabs-clean" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="front-tab" data-bs-toggle="tab"
                            data-bs-target="#front-panel" type="button" role="tab" aria-controls="front-panel"
                            aria-selected="true">
                            Vista frontal
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="back-tab" data-bs-toggle="tab" data-bs-target="#back-panel"
                            type="button" role="tab" aria-controls="back-panel" aria-selected="false">
                            Vista posterior
                        </button>
                    </li>
                </ul>
            </div>
            <div class="card-body p-0">
                <div class="row g-0 h-100">
                    <div class="col-md-7 border-end border-secondary border-opacity-25 relative-position"
                        style="position: relative;">
                        <!-- Floating Controls -->
                        <div class="map-controls">
                            <button class="btn btn-glass btn-icon mb-2" id="toggleViewBtn" title="Rotar vista"
                                aria-label="Rotar vista">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button class="btn btn-glass btn-icon" id="clearSelection" title="Limpiar selección"
                                aria-label="Limpiar selección">
                                <i class="fas fa-undo"></i>
                            </button>
                        </div>

                        <div class="tab-content p-3">
                            <div class="tab-pane fade show active" id="front-panel" role="tabpanel"
                                aria-labelledby="front-tab">
                                <div class="body-map-container body-map-front">
                                    <svg viewBox="0 0 500 750" xmlns="http://www.w3.org/2000/svg"
                                        aria-label="Mapa muscular">
                                        <g transform="translate(0, 48)">
                                            <path d="M150 70 Q250 10 350 70 L400 160 L370 540 L130 540 L100 160 Z"
                                                class="body-outline" style="opacity: 0;" />

                                            <g id="front-view">
                                                <path id="pecs-left" class="muscle" data-name="Pectorales"
                                                    d="M250 145 L250 205 Q210 210 175 170 Q180 145 250 145 Z" />
                                                <path id="pecs-right" class="muscle" data-name="Pectorales"
                                                    d="M250 145 L250 205 Q290 210 325 170 Q320 145 250 145 Z" />

                                                <path id="delts-left" class="muscle" data-name="Hombros"
                                                    d="M175 130 Q155 135 150 160 Q165 185 178 175 L175 130 Z" />
                                                <path id="delts-right" class="muscle" data-name="Hombros"
                                                    d="M325 130 Q345 135 350 160 Q335 185 322 175 L325 130 Z" />

                                                <path id="traps-left" class="muscle" data-name="Trapecios"
                                                    d="M210 110 L250 145 L175 145 Q190 120 210 110 Z" />
                                                <path id="traps-right" class="muscle" data-name="Trapecios"
                                                    d="M290 110 L250 145 L325 145 Q310 120 290 110 Z" />

                                                <path id="biceps-left" class="muscle" data-name="Biceps"
                                                    d="M150 175 Q140 200 155 225 Q170 210 165 180 Z" />
                                                <path id="biceps-right" class="muscle" data-name="Biceps"
                                                    d="M350 175 Q360 200 345 225 Q330 210 335 180 Z" />

                                                <path id="forearms-left" class="muscle" data-name="Antebrazos"
                                                    d="M140 255 L130 310 Q145 320 155 300 L150 255 Z" />
                                                <path id="forearms-right" class="muscle" data-name="Antebrazos"
                                                    d="M360 255 L370 310 Q355 320 345 300 L350 255 Z" />

                                                <path id="abs" class="muscle" data-name="Abdominales"
                                                    d="M220 205 L280 205 L270 320 L230 320 Z" />

                                                <path id="obliques-left" class="muscle" data-name="Oblicuos"
                                                    d="M190 205 L220 210 L230 320 L205 310 Z" />
                                                <path id="obliques-right" class="muscle" data-name="Oblicuos"
                                                    d="M310 205 L280 210 L270 320 L295 310 Z" />

                                                <path id="quads-left" class="muscle" data-name="Cuadriceps"
                                                    d="M175 350 L215 350 L210 450 L185 450 Q165 400 175 350 Z" />
                                                <path id="quads-right" class="muscle" data-name="Cuadriceps"
                                                    d="M325 350 L285 350 L290 450 L315 450 Q335 400 325 350 Z" />

                                                <path id="calves-left" class="muscle" data-name="Gemelos"
                                                    d="M175 508 Q165 538 175 578 Q195 558 190 508 Z" />
                                                <path id="calves-right" class="muscle" data-name="Gemelos"
                                                    d="M325 508 Q335 538 325 578 Q305 558 310 508 Z" />
                                            </g>
                                        </g>
                                    </svg>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="back-panel" role="tabpanel" aria-labelledby="back-tab">
                                <div class="body-map-container body-map-back">
                                    <svg viewBox="0 0 500 750" xmlns="http://www.w3.org/2000/svg"
                                        aria-label="Mapa muscular posterior">
                                        <g transform="translate(0, 48)">
                                            <path d="M150 70 Q250 10 350 70 L400 160 L370 540 L130 540 L100 160 Z"
                                                class="body-outline" style="opacity: 0;" />

                                            <g id="back-view">
                                                <path id="traps-back" class="muscle" data-name="Trapecios"
                                                    d="M220 110 L280 110 L310 145 L250 190 L190 145 Z" />

                                                <path id="delts-back-left" class="muscle" data-name="Hombros"
                                                    d="M190 130 L150 140 Q155 165 180 175 L190 130 Z" />
                                                <path id="delts-back-right" class="muscle" data-name="Hombros"
                                                    d="M310 130 L350 140 Q345 165 320 175 L310 130 Z" />

                                                <path id="lats-back-left" class="muscle" data-name="Dorsal ancho"
                                                    d="M195 155 L250 200 L242 260 L195 245 Q175 200 195 155 Z" />
                                                <path id="lats-back-right" class="muscle" data-name="Dorsal ancho"
                                                    d="M305 155 L250 200 L258 260 L305 245 Q325 200 305 155 Z" />

                                                <path id="lower-back" class="muscle" data-name="Lumbares"
                                                    d="M240 260 L260 260 L260 300 L240 300 Z" />

                                                <path id="triceps-back-left" class="muscle" data-name="Triceps"
                                                    d="M165 190 L175 190 L170 240 L150 230 Z" />
                                                <path id="triceps-back-right" class="muscle" data-name="Triceps"
                                                    d="M335 190 L325 190 L330 240 L350 230 Z" />

                                                <path id="forearms-back-left" class="muscle" data-name="Antebrazos"
                                                    d="M150 260 L140 320 L160 310 Z" />
                                                <path id="forearms-back-right" class="muscle" data-name="Antebrazos"
                                                    d="M350 260 L360 320 L340 310 Z" />

                                                <path id="glutes-left" class="muscle" data-name="Gluteos"
                                                    d="M195 300 L240 300 L240 370 Q195 360 195 300 Z" />
                                                <path id="glutes-right" class="muscle" data-name="Gluteos"
                                                    d="M305 300 L260 300 L260 370 Q305 360 305 300 Z" />

                                                <path id="hamstrings-left" class="muscle" data-name="Isquiotibiales"
                                                    d="M180 385 L215 385 L210 470 L185 470 Z" />
                                                <path id="hamstrings-right" class="muscle" data-name="Isquiotibiales"
                                                    d="M320 385 L285 385 L290 470 L315 470 Z" />

                                                <path id="calves-back-left" class="muscle" data-name="Gemelos"
                                                    d="M185 520 L210 520 Q205 560 190 570 L185 520 Z" />
                                                <path id="calves-back-right" class="muscle" data-name="Gemelos"
                                                    d="M315 520 L290 520 Q295 560 310 570 L315 520 Z" />
                                            </g>
                                        </g>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Info Panel (Right Side) -->
                    <div class="col-md-5 p-3 d-flex flex-column justify-content-center bg-panel-soft">
                        <div class="info-integrated text-center">
                            <div class="info-label mb-2">Músculo seleccionado</div>
                            <div id="muscleName" class="info-title mb-3">Ninguno</div>

                            <div
                                class="suggestion-box p-3 rounded-3 border border-secondary border-opacity-25 bg-opacity-10 bg-black">
                                <div class="text-secondary x-small fw-bold mb-1 text-uppercase text-start"><i
                                        class="fas fa-lightbulb text-cyber-yellow me-1"></i>Tip rápido</div>
                                <div class="suggestion-text small text-start text-white" id="muscleTip">
                                    Selecciona un músculo para mostrar tips de entrenamiento.
                                </div>
                            </div>

                            <!-- Muscle Image Card -->
                            <div id="muscleImageCard"
                                class="muscle-card-mini mt-3 p-2 rounded-3 border border-secondary border-opacity-25 bg-black d-none skeleton-pulse"
                                style="cursor: pointer;">
                                <img id="muscleImage" src="" alt="Músculo" class="img-fluid img-skeleton"
                                    onload="this.parentElement.classList.remove('skeleton-pulse'); this.classList.add('loaded')"
                                    style="max-height: 100px; filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.1));">
                                <div class="text-center mt-1"><small class="text-muted" style="font-size: 0.6rem;"><i
                                            class="fas fa-search-plus me-1"></i>Click para ampliar</small></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal para la imagen del músculo -->


            <style>
                .text-cyber-green {
                    color: var(--accent-green);
                    text-shadow: var(--accent-green-glow) 0 0 10px;
                }

                .text-cyber-blue {
                    color: var(--accent-cyan);
                }

                .nav-tabs-clean {
                    border-bottom: none;
                }

                .nav-tabs-clean .nav-link {
                    border: 1px solid transparent;
                    color: var(--text-secondary);
                    font-weight: 600;
                    padding: 0.4rem 0.9rem;
                    border-radius: 999px;
                    background: transparent;
                }

                .nav-tabs-clean .nav-link.active {
                    color: var(--text-main);
                    background: var(--bg-card-hover);
                    border-color: var(--border-color);
                }

                .btn-icon {
                    width: 38px;
                    height: 38px;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 999px;
                    padding: 0;
                }

                .body-map-container {
                    position: relative;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    padding: 1rem;
                    background: radial-gradient(circle at top, rgba(0, 210, 255, 0.08), transparent 60%);
                    border-radius: 18px;
                    border: 1px dashed var(--border-color);
                    width: 100%;
                    max-width: 520px;
                    aspect-ratio: 2 / 3;
                    min-height: 520px;
                    margin: 0 auto;
                    background-position: center;
                    background-repeat: no-repeat;
                    background-size: contain;
                }

                .body-map-front {
                    background-image: url("/static/images/examples/av1.png");
                }

                .body-map-back {
                    background-image: url("/static/images/examples/av2.png");
                }

                svg {
                    position: absolute;
                    inset: 0;
                    width: 100%;
                    height: 100%;
                    filter: drop-shadow(0 6px 14px rgba(204, 18, 18, 0.25));
                }

                .body-map-front svg {
                    transform: translateY(-8px) scale(1.02);
                    transform-origin: center;
                }

                .body-map-back svg {
                    transform: translateY(-22px) scale(1.02);
                    transform-origin: center;
                }

                .body-outline {
                    fill: rgba(148, 163, 184, 0.15);
                    stroke: var(--border-color);
                    stroke-width: 2;
                }

                .muscle {
                    fill: rgba(148, 163, 184, 0.2);
                    stroke: #6b7280;
                    stroke-width: 1;
                    transition: all 0.25s ease;
                    cursor: pointer;
                }

                .muscle:hover {
                    fill: rgba(0, 210, 255, 0.4);
                    stroke: #00d2ff;
                    transform: scale(1.01);
                    filter: drop-shadow(0 0 6px rgba(0, 210, 255, 0.5));
                }

                .muscle.active {
                    fill: rgba(239, 68, 68, 0.12);
                    /*stroke: rgba(239, 68, 68, 0.25);*/
                    stroke: #ef44449d;
                    filter: drop-shadow(0 0 6px rgba(239, 68, 68, 1));
                }

                .muscle:focus-visible {
                    outline: 2px solid rgba(0, 210, 255, 0.8);
                    outline-offset: 2px;
                }

                .muscle-tooltip {
                    position: fixed;
                    top: 0;
                    left: 0;
                    transform: translate(-50%, -120%);
                    background: rgba(15, 23, 42, 0.752);
                    color: #f8fafc;
                    padding: 0.35rem 0.6rem;
                    border-radius: 8px;
                    font-size: 0.75rem;
                    letter-spacing: 0.02em;
                    border: 1px solid rgba(148, 163, 184, 0.35);
                    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);
                    opacity: 0;
                    pointer-events: none;
                    transition: opacity 0.15s ease;
                    z-index: 2000;
                }

                .muscle-tooltip.show {
                    opacity: 1;
                }

                .info-panel {
                    border: 1px solid var(--border-color);
                    border-radius: 16px;
                    padding: 1.5rem;
                    background: var(--bg-card);
                }

                .info-label {
                    font-size: 0.75rem;
                    letter-spacing: 0.08em;
                    text-transform: uppercase;
                    color: var(--text-muted);
                    margin-bottom: 0.5rem;
                }

                .info-title {
                    font-size: 2rem;
                    font-weight: 700;
                    color: var(--text-main);
                    margin-bottom: 0.5rem;
                }

                .info-hints {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 0.5rem;
                }

                .info-pill {
                    border: 1px solid var(--border-color);
                    border-radius: 999px;
                    padding: 0.15rem 0.5rem;
                    font-size: 0.65rem;
                    background: rgba(0, 0, 0, 0.2);
                    color: var(--text-secondary);
                    font-weight: 500;
                    display: inline-flex;
                    align-items: center;
                }

                .active-pill {
                    color: #ef4444;
                    border-color: #ef4444;
                    background: rgba(239, 68, 68, 0.1);
                }

                .hover-pill {
                    color: #00d2ff;
                    border-color: #00d2ff;
                    background: rgba(0, 210, 255, 0.1);
                }

                .bg-panel-soft {
                    background: rgba(255, 255, 255, 0.02);
                }

                .x-small {
                    font-size: 0.65rem;
                }

                .suggestion-card {
                    background: linear-gradient(135deg, rgba(0, 210, 255, 0.15), rgba(0, 255, 157, 0.15));
                    border: 1px solid rgba(0, 210, 255, 0.3);
                    border-radius: 12px;
                    padding: 1rem;
                    color: var(--text-main);
                    font-size: 0.9rem;
                }

                /* Floating Controls */
                .map-controls {
                    position: absolute;
                    bottom: 1rem;
                    right: 1rem;
                    z-index: 10;
                    display: flex;
                    flex-direction: column;
                }

                @media (min-width: 992px) {
                    .map-controls {
                        bottom: auto;
                        top: 50%;
                        transform: translateY(-50%);
                    }
                }

                .btn-glass {
                    background: rgba(255, 255, 255, 0.1);
                    backdrop-filter: blur(8px);
                    -webkit-backdrop-filter: blur(8px);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    color: var(--text-main);
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                    transition: all 0.2s ease;
                }

                .btn-glass:hover {
                    background: rgba(255, 255, 255, 0.2);
                    transform: translateY(-2px);
                    color: var(--accent-cyan);
                    border-color: var(--accent-cyan);
                }

                @media (max-width: 768px) {
                    .body-map-container {
                        min-height: 420px;
                    }

                    .info-title {
                        font-size: 1.5rem;
                    }
                }
            </style>

            <script>
                const muscles = document.querySelectorAll(".muscle");
                const muscleName = document.getElementById("muscleName");
                // const muscleDescription ... (removed)
                const muscleTip = document.getElementById("muscleTip");
                const muscleImageCard = document.getElementById("muscleImageCard");
                const muscleImage = document.getElementById("muscleImage");
                const clearBtn = document.getElementById("clearSelection");
                const toggleViewBtn = document.getElementById("toggleViewBtn");
                const mapContainer = document.querySelector(".tab-content");

                // ... (muscleImages and muscleTips objects remain the same) ...

                const muscleImages = {
                    "Pectorales": "pec.png",
                    "Hombros": "hom.png",
                    "Trapecios": "esp.png",
                    "Dorsal ancho": "esp.png",
                    "Lumbares": "esp.png",
                    "Biceps": "bic.png",
                    "Triceps": "tri.png",
                    "Antebrazos": "ant.png",
                    "Abdominales": "abs.png",
                    "Oblicuos": "abs.png",
                    "Cuadriceps": "cua.png",
                    "Gemelos": "gem.png",
                    "Gluteos": "glu.png",
                    "Isquiotibiales": "isq.png"
                };

                const muscleTips = {
                    "Pectorales": "Prueba press de banca e inclinados para activar el pecho completo.",
                    "Hombros": "Incluye press militar y elevaciones laterales para volumen.",
                    "Biceps": "Combina curl con barra y curl martillo para variedad.",
                    "Abdominales": "Alterna planchas con crunches controlados.",
                    "Cuadriceps": "Sentadillas y prensa son claves para fuerza frontal.",
                    "Trapecios": "Encogimientos y remo al mentón ayudan a activar trapecios.",
                    "Oblicuos": "Twists y planchas laterales son ideales para oblicuos.",
                    "Antebrazos": "Farmer walks y curls inversos fortalecen el agarre.",
                    "Gemelos": "Elevaciones de talón ayudan a fortalecer los gemelos.",
                    "Gluteos": "Hip thrust y sentadillas profundas activan glúteos.",
                    "Dorsal ancho": "Dominadas y remos son fundamentales para la amplitud.",
                    "Lumbares": "Hiperextensiones y peso muerto fortalecen la zona baja.",
                    "Isquiotibiales": "Peso muerto rumano y curl femoral para la parte posterior.",
                    "Triceps": "Fondos y extensiones de polea para dar tamaño al brazo."
                };

                function clearSelection() {
                    muscles.forEach(m => m.classList.remove("active"));
                    muscleName.textContent = "Ninguno";
                    muscleTip.textContent = "Selecciona un músculo para mostrar tips de entrenamiento.";
                    muscleImageCard.classList.add("d-none");
                }

                // Toggle View Logic
                toggleViewBtn?.addEventListener("click", () => {
                    const frontTab = document.getElementById("front-tab");
                    const backTab = document.getElementById("back-tab");

                    if (frontTab.classList.contains("active")) {
                        backTab.click(); // Switch to back
                    } else {
                        frontTab.click(); // Switch to front
                    }
                });

                const tooltip = document.createElement("div");
                tooltip.className = "muscle-tooltip";
                document.body.appendChild(tooltip);

                function showTooltip(name, event) {
                    tooltip.textContent = name;
                    tooltip.style.left = `${event.clientX}px`;
                    tooltip.style.top = `${event.clientY}px`;
                    tooltip.classList.add("show");
                }

                function hideTooltip() {
                    tooltip.classList.remove("show");
                }

                muscles.forEach(muscle => {
                    const nameAttr = muscle.getAttribute("data-name") || "Músculo";
                    muscle.setAttribute("tabindex", "0");
                    muscle.setAttribute("role", "button");
                    muscle.setAttribute("aria-label", nameAttr);
                });

                function selectMuscle(name) {
                    muscles.forEach(m => m.classList.remove("active"));
                    document.querySelectorAll(`.muscle[data-name="${name}"]`).forEach(m => {
                        m.classList.add("active");
                    });
                    muscleName.textContent = name;
                    // muscleDescription.textContent = `Seleccionaste ${name}. Puedes filtrar tus entrenamientos por este grupo.`;
                    muscleTip.textContent = muscleTips[name] || "Explora ejercicios enfocados en este músculo.";

                    // Update Image
                    if (muscleImages[name]) {
                        // Reset skeleton state
                        muscleImage.classList.remove('loaded');
                        muscleImageCard.classList.add('skeleton-pulse');

                        muscleImage.src = `/static/images/muscles/male/${muscleImages[name]}`;
                        muscleImageCard.classList.remove("d-none");
                    } else {
                        muscleImageCard.classList.add("d-none");
                    }
                }

                mapContainer?.addEventListener("click", (event) => {
                    const target = event.target;
                    if (!(target instanceof Element)) {
                        return;
                    }
                    const muscle = target.closest(".muscle");
                    if (!muscle) {
                        return;
                    }
                    const name = muscle.getAttribute("data-name") || "Músculo";
                    selectMuscle(name);
                });

                let tooltipRaf = 0;
                mapContainer?.addEventListener("pointerenter", (event) => {
                    const target = event.target;
                    if (!(target instanceof Element)) {
                        return;
                    }
                    const muscle = target.closest(".muscle");
                    if (!muscle) {
                        return;
                    }
                    const nameAttr = muscle.getAttribute("data-name");
                    if (nameAttr) {
                        showTooltip(nameAttr, event);
                    }
                }, true);

                mapContainer?.addEventListener("pointermove", (event) => {
                    if (!tooltip.classList.contains("show")) {
                        return;
                    }
                    if (tooltipRaf) {
                        cancelAnimationFrame(tooltipRaf);
                    }
                    tooltipRaf = requestAnimationFrame(() => {
                        tooltip.style.left = `${event.clientX}px`;
                        tooltip.style.top = `${event.clientY}px`;
                    });
                });

                mapContainer?.addEventListener("pointerleave", hideTooltip, true);
                window.addEventListener("scroll", hideTooltip, true);

                document.addEventListener("keydown", (event) => {
                    if (event.key !== "Enter" && event.key !== " ") {
                        return;
                    }
                    const target = event.target;
                    if (!(target instanceof Element)) {
                        return;
                    }
                    const muscle = target.closest(".muscle");
                    if (!muscle) {
                        return;
                    }
                    const name = muscle.getAttribute("data-name") || "Músculo";
                    event.preventDefault();
                    selectMuscle(name);
                });

                clearBtn?.addEventListener("click", clearSelection);

                const muscleDescriptions = {
                    "hombros": `<strong>Nombres alternativos:</strong> Deltoides, "Deltos".<br><br><strong>Descripción y partes:</strong> Músculo que envuelve la articulación del hombro, dando forma redondeada.<br>• <strong>Deltoides anterior:</strong> Parte frontal (empujes).<br>• <strong>Deltoides lateral (medial):</strong> Parte lateral (anchura).<br>• <strong>Deltoides posterior:</strong> Parte trasera (tracción).`,
                    "pectorales": `<strong>Nombres alternativos:</strong> Pectorales, "Pecs", torso anterior.<br><br><strong>Descripción y partes:</strong> Músculo grande en la parte frontal de la caja torácica. Es clave para movimientos de empuje.<br>• <strong>Pectoral mayor:</strong> Se divide funcionalmente en fascículo clavicular (parte superior), esternocostal (parte media) y abdominal (parte inferior).<br>• <strong>Pectoral menor:</strong> Situado debajo del mayor.`,
                    "espalda": `<strong>Nombres alternativos:</strong> Dorsales, espalda alta/media/baja.<br><br><strong>Descripción y partes:</strong> Grupo complejo que cubre la parte posterior del tronco.<br>• <strong>Dorsal ancho (lats):</strong> Da la forma de "V".<br>• <strong>Trapecios:</strong> Parte superior (cuello/hombros), media e inferior.<br>• <strong>Romboides:</strong> Entre los omóplatos.<br>• <strong>Erectores espinales / lumbares:</strong> Zona baja de la espalda (estabilidad).`,
                    "biceps": `<strong>Nombres alternativos:</strong> Bíceps braquial, "conejos" (coloquial).<br><br><strong>Descripción y partes:</strong> Músculo de dos cabezas en la parte frontal del brazo.<br>• <strong>Cabeza larga:</strong> Parte externa.<br>• <strong>Cabeza corta:</strong> Parte interna.<br>• <strong>Braquial:</strong> Músculo profundo situado bajo el bíceps (da volumen).`,
                    "triceps": `<strong>Nombres alternativos:</strong> Tríceps braquial.<br><br><strong>Descripción y partes:</strong> Músculo de tres cabezas en la parte posterior del brazo. Ocupa 2/3 del volumen del brazo.<br>• <strong>Cabeza larga:</strong> La más grande, parte interna.<br>• <strong>Cabeza lateral:</strong> La parte externa visible.<br>• <strong>Cabeza medial:</strong> Situada más abajo, cerca del codo.`,
                    "antebrazos": `<strong>Nombres alternativos:</strong> Flexores/extensores de la muñeca.<br><br><strong>Descripción y partes:</strong> Conjunto de múltiples músculos pequeños responsables del agarre.<br>• <strong>Braquiorradial:</strong> El músculo más visible en la parte superior del antebrazo.<br>• <strong>Flexores y extensores:</strong> Grupos musculares para mover dedos y muñeca.`,
                    "abdominales": `<strong>Nombres alternativos:</strong> Core, recto abdominal, "six-pack", abdominales.<br><br><strong>Descripción y partes:</strong> Centro de gravedad y estabilidad del cuerpo.<br>• <strong>Recto abdominal:</strong> La "tableta" frontal.<br>• <strong>Oblicuos (externos e internos):</strong> Los laterales del torso.<br>• <strong>Transverso:</strong> Músculo profundo (faja natural).<br>• <strong>Serratos:</strong> Músculos en forma de "dientes" sobre las costillas.`,
                    "gluteos": `<strong>Nombres alternativos:</strong> Nalgas, trasero.<br><br><strong>Descripción y partes:</strong> El grupo muscular más grande y fuerte del cuerpo.<br>• <strong>Glúteo mayor:</strong> La parte principal y más visible.<br>• <strong>Glúteo medio:</strong> Parte lateral superior (estabilidad de cadera).<br>• <strong>Glúteo menor:</strong> Profundo, bajo el medio.`,
                    "cuadriceps": `<strong>Nombres alternativos:</strong> Cuádriceps femoral, muslo anterior.<br><br><strong>Descripción y partes:</strong> Grupo de cuatro músculos en la parte frontal del muslo.<br>• <strong>Recto femoral:</strong> El músculo central que cruza la cadera.<br>• <strong>Vasto lateral:</strong> Parte externa (da la curva exterior).<br>• <strong>Vasto medial:</strong> Parte interna (forma de gota cerca de la rodilla).<br>• <strong>Vasto intermedio:</strong> Profundo, bajo el recto femoral.`,
                    "femoral": `<strong>Nombres alternativos:</strong> Femorales, isquiosurales, isquios, parte posterior del muslo.<br><br><strong>Descripción y partes:</strong> Grupo muscular en la parte trasera del muslo.<br>• <strong>Bíceps femoral:</strong> Parte externa (cabeza larga y corta).<br>• <strong>Semitendinoso y semimembranoso:</strong> Parte interna.`,
                    "gemelos": `<strong>Nombres alternativos:</strong> Tríceps sural, gemelos, chamorros (coloquial en MX).<br><br><strong>Descripción y partes:</strong> Parte posterior de la pierna baja.<br>• <strong>Gastrocnemio (gemelos):</strong> El músculo visible con forma de diamante (cabeza interna y externa).<br>• <strong>Sóleo:</strong> Músculo plano situado debajo de los gemelos (visible a los lados del tobillo).`
                };

                const glossaryMap = {
                    "Pectorales": "pectorales",
                    "Hombros": "hombros",
                    "Trapecios": "espalda",
                    "Dorsal ancho": "espalda",
                    "Lumbares": "espalda",
                    "Biceps": "biceps",
                    "Triceps": "triceps",
                    "Antebrazos": "antebrazos",
                    "Abdominales": "abdominales",
                    "Oblicuos": "abdominales",
                    "Cuadriceps": "cuadriceps",
                    "Gemelos": "gemelos",
                    "Gluteos": "gluteos",
                    "Isquiotibiales": "femoral"
                };

                // Modal Zoom Logic// Modal Zoom Logic
                document.addEventListener('DOMContentLoaded', function () {
                    const modalElement = document.getElementById('imageModal');
                    if (modalElement) {
                        const modalImage = document.getElementById('modalImage');
                        const modalTitle = document.getElementById('imageModalLabel');
                        const modalTip = document.getElementById('modalMuscleTip');
                        const modalDesc = document.getElementById('modalMuscleDesc');

                        // Ensure bootstrap is available
                        if (typeof bootstrap !== 'undefined') {
                            const modal = new bootstrap.Modal(modalElement);

                            if (muscleImageCard && muscleImage) {
                                muscleImageCard.addEventListener('click', () => {
                                    const src = muscleImage.src;
                                    const mapName = muscleName.textContent;

                                    if (src && !muscleImageCard.classList.contains('d-none')) {
                                        modalImage.src = src;
                                        modalTitle.textContent = mapName;

                                        // Set Tip
                                        const tip = muscleTips[mapName] || "";
                                        modalTip.textContent = tip;

                                        // Set Description
                                        const descriptionKey = glossaryMap[mapName];
                                        const description = muscleDescriptions[descriptionKey] || "";
                                        modalDesc.innerHTML = description;

                                        modal.show();
                                    }
                                });
                            }
                        } else {
                            console.error("Bootstrap not loaded");
                        }
                    }
                });

            </script>

            <!-- Modal for Fullscreen Image -->
            <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content bg-dark">
                        <div class="modal-header border-bottom border-secondary border-opacity-25">
                            <h5 class="modal-title text-white fw-bold" id="imageModalLabel"></h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-0 d-flex flex-column h-100 bg-dark">
                            <div class="p-4 flex-shrink-0">
                                <div class="container-fluid" style="max-width: 800px;">
                                    <h5 class="text-cyber-green fw-bold mb-3" id="modalTitleDisplay"
                                        style="display:none;"></h5>

                                    <div class="suggestion-card mb-3">
                                        <div
                                            class="text-secondary x-small fw-bold mb-2 text-uppercase d-flex align-items-center">
                                            <i class="fas fa-lightbulb text-cyber-yellow me-2"></i>Tip Rápido
                                        </div>
                                        <div id="modalMuscleTip" class="text-white small"></div>
                                    </div>

                                    <div id="modalMuscleDesc"
                                        class="text-secondary small border-top border-secondary border-opacity-25 pt-3">
                                        <!-- Description injected here -->
                                    </div>
                                </div>
                            </div>

                            <div class="flex-grow-1 d-flex align-items-center justify-content-center p-3 relative-position"
                                style="min-height: 0; background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0) 70%);">
                                <img src="" id="modalImage" class="img-fluid"
                                    style="max-height: 100%; max-width: 100%; object-fit: contain;"
                                    alt="Imagen del músculo">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endblock %}