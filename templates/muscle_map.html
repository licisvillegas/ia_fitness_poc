{% extends 'layout.html' %}

{% block title %}AI Fitness - Mapa Muscular
{% endblock %}

{% block sidebar %}
{% include 'components/sidebar.html' %}

{% endblock %}

{% block content %}
<link href="/static/css/muscle_map.css" rel="stylesheet">
<div class="row align-items-center mb-4">
    <div class="col-lg-8">
        <h2 class="fw-bold text-cyber-green mb-1"><i class="fas fa-project-diagram me-2"></i>Mapa Muscular</h2>
        <p class="text-secondary mb-2 d-none d-md-block">Selecciona un músculo para ver información rápida y enfocarte en el grupo.</p>
        <div class="d-flex flex-wrap gap-1 mb-2">
            <div class="info-pill"><i class="fas fa-mouse-pointer me-1"></i>Click</div>
            <div class="info-pill active-pill"><i class="fas fa-highlighter me-1"></i>Activo</div>
            <div class="info-pill hover-pill"><i class="fas fa-wave-square me-1"></i>Hover</div>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-lg-10 col-xl-8 mx-auto">
        <div class="card bg-panel border-0 shadow-sm h-100">
            <div
                class="card-header border-secondary text-white fw-bold d-flex flex-wrap align-items-center justify-content-between gap-2">
                <div class="d-flex align-items-center gap-2">
                    <i class="fas fa-map text-cyber-blue"></i>
                    Mapa muscular
                </div>
                <div class="d-flex align-items-center gap-2">
                    <button type="button" id="gender-toggle" class="btn btn-sm btn-outline-secondary" aria-label="Cambiar genero">
                        <i class="fas fa-mars me-1"></i><span class="d-none d-sm-inline">Masculino</span>
                    </button>
                    <ul class="nav nav-tabs nav-tabs-clean" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="front-tab" data-bs-toggle="tab"
                            data-bs-target="#front-panel" type="button" role="tab" aria-controls="front-panel"
                            aria-selected="true">
                            Vista frontal
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="back-tab" data-bs-toggle="tab" data-bs-target="#back-panel"
                            type="button" role="tab" aria-controls="back-panel" aria-selected="false">
                            Vista posterior
                        </button>
                    </li>
                    </ul>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="row g-0 h-100">
                    <div class="col-md-7 border-end border-secondary border-opacity-25 relative-position"
                        style="position: relative;">
                        <!-- Controles flotantes -->
                                                <div class="map-controls">
                            <button class="btn btn-glass btn-icon mb-2" id="toggleViewBtn" title="Rotar vista"
                                aria-label="Rotar vista">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button class="btn btn-glass btn-icon" id="clearSelection" title="Limpiar seleccion"
                                aria-label="Limpiar seleccion">
                                <i class="fas fa-undo"></i>
                            </button>
                            <select class="form-select form-select-sm bg-dark text-white border-secondary d-none"
                                id="adminThemeSelect" aria-label="ThemaBody">
                                <option value="HD1">HD1</option>
                                <option value="HD2">HD2</option>
                                <option value="HR1">HR1</option>
                                <option value="HR2">HR2</option>
                            </select>
                        </div>

                        <div class="tab-content p-3">
                            <div class="tab-pane fade show active" id="front-panel" role="tabpanel"
                                aria-labelledby="front-tab">
                                <div class="body-map-container body-map-front">
                                    <svg viewBox="0 0 500 750" xmlns="http://www.w3.org/2000/svg"
                                        aria-label="Mapa muscular">
                                        <g transform="translate(0, 48)">
                                            <path d="M150 70 Q250 10 350 70 L400 160 L370 540 L130 540 L100 160 Z"
                                                class="body-outline" style="opacity: 0;" />

                                            <g id="front-view">
                                                <path id="pecs-left" class="muscle" data-name="Pectorales"
                                                    d="M250 145 L250 205 Q210 210 175 170 Q180 145 250 145 Z" />
                                                <path id="pecs-right" class="muscle" data-name="Pectorales"
                                                    d="M250 145 L250 205 Q290 210 325 170 Q320 145 250 145 Z" />

                                                <path id="delts-left" class="muscle" data-name="Hombros"
                                                    d="M175 130 Q155 135 150 160 Q165 185 178 175 L175 130 Z" />
                                                <path id="delts-right" class="muscle" data-name="Hombros"
                                                    d="M325 130 Q345 135 350 160 Q335 185 322 175 L325 130 Z" />

                                                <path id="traps-left" class="muscle" data-name="Trapecios"
                                                    d="M210 110 L250 145 L175 145 Q190 120 210 110 Z" />
                                                <path id="traps-right" class="muscle" data-name="Trapecios"
                                                    d="M290 110 L250 145 L325 145 Q310 120 290 110 Z" />

                                                <path id="biceps-left" class="muscle" data-name="Biceps"
                                                    d="M150 175 Q140 200 155 225 Q170 210 165 180 Z" />
                                                <path id="biceps-right" class="muscle" data-name="Biceps"
                                                    d="M350 175 Q360 200 345 225 Q330 210 335 180 Z" />

                                                <path id="forearms-left" class="muscle" data-name="Antebrazos"
                                                    d="M145 320 L155 265 Q140 255 130 275 L135 320 Z" />
                                                <path id="forearms-right" class="muscle" data-name="Antebrazos"
                                                    d="M355 320 L345 265 Q360 255 370 275 L365 320 Z" />

                                                <path id="abs" class="muscle" data-name="Abdominales"
                                                    d="M220 205 L280 205 L270 320 L230 320 Z" />

                                                <path id="obliques-left" class="muscle" data-name="Oblicuos"
                                                    d="M190 205 L220 210 L230 320 L205 310 Z" />
                                                <path id="obliques-right" class="muscle" data-name="Oblicuos"
                                                    d="M310 205 L280 210 L270 320 L295 310 Z" />

                                                <path id="quads-left" class="muscle" data-name="Cuadriceps"
                                                    d="M175 350 L215 350 L210 450 L185 450 Q165 400 175 350 Z" />
                                                <path id="quads-right" class="muscle" data-name="Cuadriceps"
                                                    d="M325 350 L285 350 L290 450 L315 450 Q335 400 325 350 Z" />
                                                <path id="adductors-left" class="muscle" data-name="Aductores"
                                                    d="M220 381 Q210 411 220 451 Q240 431 235 381 Z" />
                                                <path id="adductors-right" class="muscle" data-name="Aductores"
                                                    d="M280 381 Q290 411 280 451 Q260 431 265 381 Z" />

                                                <path id="calves-left" class="muscle" data-name="Gemelos"
                                                    d="M175 508 Q165 538 175 578 Q195 558 190 508 Z" />
                                                <path id="calves-right" class="muscle" data-name="Gemelos"
                                                    d="M325 508 Q335 538 325 578 Q305 558 310 508 Z" />
                                            </g>
                                        </g>
                                    </svg>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="back-panel" role="tabpanel" aria-labelledby="back-tab">
                                <div class="body-map-container body-map-back">
                                    <svg viewBox="0 0 500 750" xmlns="http://www.w3.org/2000/svg"
                                        aria-label="Mapa muscular posterior">
                                        <g transform="translate(0, 48)">
                                            <path d="M150 70 Q250 10 350 70 L400 160 L370 540 L130 540 L100 160 Z"
                                                class="body-outline" style="opacity: 0;" />

                                            <g id="back-view">
                                                <path id="traps-back" class="muscle" data-name="Trapecios"
                                                    d="M220 110 L280 110 L310 145 L250 190 L190 145 Z" />

                                                <path id="delts-back-left" class="muscle" data-name="Hombros"
                                                    d="M190 130 L150 140 Q155 165 180 175 L190 130 Z" />
                                                <path id="delts-back-right" class="muscle" data-name="Hombros"
                                                    d="M310 130 L350 140 Q345 165 320 175 L310 130 Z" />

                                                <path id="lats-back-left" class="muscle" data-name="Dorsal ancho"
                                                    d="M195 155 L250 200 L242 260 L195 245 Q175 200 195 155 Z" />
                                                <path id="lats-back-right" class="muscle" data-name="Dorsal ancho"
                                                    d="M305 155 L250 200 L258 260 L305 245 Q325 200 305 155 Z" />

                                                <path id="lower-back" class="muscle" data-name="Lumbares"
                                                    d="M240 260 L260 260 L260 300 L240 300 Z" />

                                                <path id="triceps-back-left" class="muscle" data-name="Triceps"
                                                    d="M155 190 L165 190 L160 240 L140 230 Z" />
                                                <path id="triceps-back-right" class="muscle" data-name="Triceps"
                                                    d="M345 190 L335 190 L340 240 L360 230 Z" />

                                                <path id="forearms-back-left" class="muscle" data-name="Antebrazos"
                                                    d="M145 320 L155 265 Q140 255 130 275 L135 320 Z" />
                                                <path id="forearms-back-right" class="muscle" data-name="Antebrazos"
                                                    d="M355 320 L345 265 Q360 255 370 275 L365 320 Z" />

                                                <path id="glutes-left" class="muscle" data-name="Gluteos"
                                                      d="M195 315 L240 315 L240 385 Q195 375 195 315 Z" />
                                                <path id="glutes-right" class="muscle" data-name="Gluteos"
                                                      d="M305 315 L260 315 L260 385 Q305 375 305 315 Z" />
                                                <path id="abductors-back-left" class="muscle" data-name="Abductores"
                                                    d="M185 335 L195 335 L190 385 L170 375 Z" />
                                                <path id="abductors-back-right" class="muscle" data-name="Abductores"
                                                    d="M315 335 L305 335 L310 385 L330 375 Z" />

                                                <path id="hamstrings-left" class="muscle" data-name="Isquiotibiales"
                                                      d="M180 400 L215 400 L210 485 L185 485 Z" />
                                                <path id="hamstrings-right" class="muscle" data-name="Isquiotibiales"
                                                      d="M320 400 L285 400 L290 485 L315 485 Z" />
                                                <path id="adductors-back-left" class="muscle" data-name="Aductores"
                                                    d="M225 395 Q215 420 225 460 Q245 440 240 395 Z" />
                                                <path id="adductors-back-right" class="muscle" data-name="Aductores"
                                                    d="M275 395 Q285 420 275 460 Q255 440 260 395 Z" />

                                                <path id="calves-back-left" class="muscle" data-name="Gemelos"
                                                      d="M175 508 Q165 538 175 578 Q195 558 190 508 Z" />
                                                <path id="calves-back-right" class="muscle" data-name="Gemelos"
                                                      d="M325 508 Q335 538 325 578 Q305 558 310 508 Z" />
                                            </g>
                                        </g>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Panel de informacion (lado derecho) -->
                    <div class="col-md-5 p-3 d-flex flex-column justify-content-center bg-panel-soft">
                        <div class="info-integrated text-center">
                            <div class="info-label mb-2">Músculo seleccionado</div>
                            <div id="muscleName" class="info-title mb-3">Ninguno</div>

                            <div
                                class="suggestion-box p-3 rounded-3 border border-secondary border-opacity-25 bg-opacity-10 bg-black">
                                <div class="text-secondary x-small fw-bold mb-1 text-uppercase text-start"><i
                                        class="fas fa-lightbulb text-cyber-yellow me-1"></i>Tip rápido</div>
                                <div class="suggestion-text small text-start text-white" id="muscleTip">
                                    Selecciona un músculo para mostrar tips de entrenamiento.
                                </div>
                            </div>

                            <!-- Tarjeta de imagen muscular -->
                            <div id="muscleImageCard"
                                class="muscle-card-mini mt-3 p-2 rounded-3 border border-secondary border-opacity-25 bg-black d-none skeleton-pulse"
                                style="cursor: pointer;">
                                <img id="muscleImage" src="" alt="Músculo" class="img-fluid img-skeleton"
                                    onload="this.parentElement.classList.remove('skeleton-pulse'); this.classList.add('loaded')"
                                    style="max-height: 100px; filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.1));">
                                <div class="text-center mt-1"><small class="text-muted" style="font-size: 0.6rem;"><i
                                            class="fas fa-search-plus me-1"></i>Click para ampliar</small></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal para la imagen del músculo -->
<!-- Modal para imagen en pantalla completa -->
            <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-fullscreen">
                    <div class="modal-content bg-dark">
                        <div class="modal-header border-bottom border-secondary border-opacity-25">
                            <h5 class="modal-title text-white fw-bold" id="imageModalLabel"></h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                                aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-0 d-flex flex-column h-100 bg-dark">
                            <div class="p-4 flex-shrink-0">
                                <div class="container-fluid" style="max-width: 800px;">
                                    <h5 class="text-cyber-green fw-bold mb-3" id="modalTitleDisplay"
                                        style="display:none;"></h5>

                                    <div class="suggestion-card mb-3">
                                        <div
                                            class="text-secondary x-small fw-bold mb-2 text-uppercase d-flex align-items-center">
                                            <i class="fas fa-lightbulb text-cyber-yellow me-2"></i>Tip Rápido
                                        </div>
                                        <div id="modalMuscleTip" class="text-white small"></div>
                                    </div>

                                    <div id="modalMuscleDesc"
                                        class="text-secondary small border-top border-secondary border-opacity-25 pt-3">
                                        <!-- Descripcion inyectada aqui -->
                                    </div>
                                </div>
                            </div>

                            <div class="flex-grow-1 d-flex align-items-center justify-content-center p-3 relative-position"
                                style="min-height: 0; background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0) 70%);">
                                <img src="" id="modalImage" class="img-fluid"
                                    style="max-height: 100%; max-width: 100%; object-fit: contain;"
                                    alt="Imagen del músculo">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
<script src="/static/js/muscle_map.js"></script>
{% endblock %}


