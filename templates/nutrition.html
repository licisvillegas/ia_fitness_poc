<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>
    AI Fitness | Nutrición Inteligente
  </title>
  <!-- Bootstrap + TipografÃ­a -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&amp;display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />
  <link href="/static/css/theme.css" rel="stylesheet">
  <link href="/static/css/sidebar.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg-body);
      color: var(--text-main);
      overflow-x: hidden;
    }

    /* Navbar */
    .navbar {
      background-color: var(--bg-panel);
      border-bottom: 1px solid var(--border-color);
    }

    .navbar-brand {
      color: var(--primary) !important;
      font-weight: 700;
    }

    .navbar a {
      color: var(--text-main) !important;
    }

    /* Hero Section */
    .hero {
      position: relative;
      background: linear-gradient(to right, rgba(0, 0, 0, 0.6), rgba(37, 99, 235, 0.25));
      background-color: var(--bg-body);
      /* fallback */
      height: 90vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: white;
      /* Always white over video/image */
      overflow: hidden;
    }

    /* Video background placed absolutely behind hero content */
    .hero-video {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      height: 100%;
      transform: translate(-50%, -50%);
      object-fit: cover;
      z-index: 0;
      pointer-events: none;
    }

    /* Overlay so text remains readable */
    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to right, rgba(0, 0, 0, 0.45), rgba(37, 99, 235, 0.18));
      z-index: 1;
    }

    /* Ensure container content sits above video */
    .hero .container {
      position: relative;
      z-index: 2;
    }

    /* Hide video on small screens to save bandwidth */
    @media (max-width: 767px) {
      .hero-video {
        display: none;
      }

      .hero {
        background-image: url('/static/images/IMG_1571.jpg');
        background-size: cover;
        background-position: center;
      }
    }

    /* Respect user preference to reduce motion */
    @media (prefers-reduced-motion: reduce) {
      .hero-video {
        display: none;
      }

      .hero {
        background-image: url('/static/images/IMG_1571.jpg');
        background-size: cover;
        background-position: center;
      }
    }

    .hero h1 {
      font-size: 3rem;
      font-weight: 700;
    }

    /* Daily Plan */
    .daily-plan {
      padding: 3rem 0 0 0;
    }

    /* Meal Cards */
    .meal-card {
      background-color: var(--bg-card);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      margin-bottom: 1rem;
      border: 1px solid var(--border-color);
    }

    .meal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.85rem 1rem;
      background-color: var(--bg-panel);
      cursor: pointer;
      border-bottom: 1px solid var(--border-color);
    }

    .meal-header:hover {
      background-color: var(--bg-card-hover);
    }

    .meal-title {
      margin: 0;
      font-size: 1.1rem;
      color: var(--text-main);
    }

    .nutrition-list {
      list-style: none;
      margin: 0;
      padding: 0.75rem 1rem;
    }

    .meal-details p {
      margin: 0 1rem 1rem;
      color: var(--text-secondary);
    }

    /* Recipes */
    .recipes {
      padding: 4rem 0;
    }

    .recipe-card {
      background-color: var(--bg-card);
      border-radius: 15px;
      overflow: hidden;
      transition: 0.3s;
      height: 100%;
      border: 1px solid var(--border-color);
    }

    .recipe-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }

    .recipe-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 20px rgba(37, 99, 235, 0.3);
      background-color: var(--bg-card-hover);
    }

    .recipe-card h5 {
      color: var(--primary);
    }

    /* Equivalences */
    .equivalences {
      background-color: var(--bg-panel);
      padding: 4rem 0;
    }

    .equivalences h2 {
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 2rem;
    }

    .table {
      color: var(--text-main);
      background-color: transparent;
    }

    .table thead {
      color: var(--primary);
      border-color: var(--border-color);
    }

    .table-striped>tbody>tr:nth-of-type(odd)>* {
      background-color: transparent !important;
      /* Let bg-card handle it via row style */
      box-shadow: inset 0 0 0 9999px var(--bg-input);
      /* Bootstrap way to stripe */
      color: var(--text-main);
    }

    .table-striped>tbody>tr:nth-of-type(even)>* {
      background-color: transparent !important;
      color: var(--text-main);
    }

    .table> :not(caption)>*>* {
      background-color: transparent;
      /* Reset bootstrap defaults */
      color: var(--text-main);
      border-color: var(--border-color);
    }

    /* Footer */
    footer {
      background-color: var(--bg-panel);
      color: var(--text-muted);
      text-align: center;
      padding: 1rem 0;
      margin-top: 3rem;
      border-top: 1px solid var(--border-color);
    }

    @keyframes alertSlideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .alert-modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 3000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .alert-modal-backdrop.show {
      display: flex;
    }

    .alert-modal-card {
      width: 100%;
      max-width: 420px;
      background: #0b0b0b;
      border: 1px solid #2a2a2a;
      border-radius: 18px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
      padding: 1.5rem;
      color: #fff;
      animation: alertSlideIn 0.25s ease-out;
    }

    .alert-modal-card .alert-title {
      font-weight: 700;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .alert-modal-card .alert-message {
      color: #c7c7c7;
      margin-bottom: 1.25rem;
      line-height: 1.4;
    }

    .alert-modal-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    .alert-tone-warning {
      color: #ff9d00;
    }

    .alert-tone-danger {
      color: #ff5c5c;
    }

    .alert-tone-success {
      color: #00ff9d;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <!-- Navbar -->
  {% include 'components/sidebar.html' %}
  <div class="main-content">
    <!-- Hero -->
    <section class="hero">
      <!-- Video background (fallback to poster image if video missing) -->
      <video autoplay="" class="hero-video" loop="" muted="" playsinline="" poster="/static/images/IMG_1571.jpg">
        <source src="/static/videos/B6C7D05D-8000-462D-89CE-BE94145A4123.MP4" type="video/mp4" />
        <!-- If video not supported, the poster/background will be shown -->
      </video>
      <div aria-hidden="true" class="hero-overlay">
      </div>
      <div class="container">
        <h1 id="nutrition-hero-title">
          Nutrición Inteligente para un Rendimiento Óptimo
        </h1>
        <p class="lead mt-3" id="nutrition-hero-p">
          Descubre recetas saludables y aprende a equilibrar tus alimentos con equivalencias precisas.
        </p>
      </div>
    </section>

    <!-- Generador de plan diario (AI) -->
    <section class="daily-plan">
      <div class="container mt-4">
        <h3 class="text-center mb-4">Plan de Nutrición (AI)</h3>
        {% if current_user_role == 'admin' %}
        <div class="text-center mb-3" id="daily-plan-controls" style="display:none;">
          <div class="input-group justify-content-center" style="max-width:820px;margin:0 auto;gap:8px;">
            <input id="nutriUserId" type="text" class="form-control text-center"
              placeholder="user_id o deja vacío para usar el del login" autocomplete="off" autocorrect="off"
              autocapitalize="off" spellcheck="false">
            <select id="nutriMeals" class="form-select" style="max-width:120px;">
              <option value="3">3 comidas</option>
              <option value="4">4 comidas</option>
              <option value="5">5 comidas</option>
              <option value="6" selected>6 comidas</option>
            </select>
            <input id="nutriPrefs" type="text" class="form-control" placeholder="preferencias (opcional)">
            <input id="nutriExclude" type="text" class="form-control" placeholder="exclusiones (opcional)">
            <button id="btnGenMeals" class="btn btn-primary">Generar plan</button>
            <button id="btnSaveMealPlan" class="btn btn-success" style="display:none;">
              Guardar y activar
            </button>
          </div>
          <div class="mt-2">
            <input id="nutriCuisine" type="text" class="form-control" style="max-width:820px;margin:0 auto;"
              placeholder="cocina preferida / notas (opcional)">
          </div>
          <div id="nutriMsg" class="mt-2 text-info"></div>
        </div>
        <script>
          (function () {
            try {
              if (sessionStorage.getItem('admin_unlocked') === 'true') {
                const controls = document.getElementById('daily-plan-controls');
                if (controls) controls.style.display = 'block';
              }
            } catch (e) { }
          })();
        </script>
        {% endif %}
        <div id="mealsContainer"></div>
      </div>
    </section>

    <!-- Recetas -->
    <section class="recipes">
      <div class="container text-center mb-5">
        <h2 id="recipes-title" class="fw-bold text-theme">Recetas Fitness</h2>
        <p id="recipes-sub" class="text-secondary">Fáciles, nutritivas y llenas de energía para acompañar tus
          entrenamientos.</p>
      </div>

      <div class="container">
        <div class="row g-4">
          <div class="col-md-4">
            <div class="recipe-card">
              <img
                src="https://storage.googleapis.com/fitia_public_images/recipes%2FGR-R-V-00006049_k7e35yjcue169n3bjafdcxao_large.jpg"
                alt="Avena proteica">
              <div class="p-3">
                <h5 data-i18n="avena_proteica">Avena Proteica</h5>
                <p class="text-secondary small"
                  data-i18n="avena_proteína_en_polvo_banana_y_canela_ideal_para_comenzar_">Avena, proteína en polvo,
                  banana y canela. Ideal para comenzar el día lleno de energía.</p>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="recipe-card">
              <img src="https://storage.googleapis.com/avena-recipes-v2/2019/10/1571783768842.jpeg"
                alt="Bowl de pollo y quinoa">
              <div class="p-3">
                <h5 data-i18n="bowl_de_pollo_y_quinoa">Bowl de Pollo y Quinoa</h5>
                <p class="text-secondary small"
                  data-i18n="combinación_equilibrada_de_proteínas_granos_y_vegetales_para">Combinación equilibrada de
                  proteínas, granos y vegetales para recuperación muscular.</p>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="recipe-card">
              <img src="https://zenu.com.co/wp-content/uploads/2023/12/wrap-de-atun-zenu.jpeg" alt="Wrap de atún">
              <div class="p-3">
                <h5 data-i18n="wrap_de_atún">Wrap de Atún</h5>
                <p class="text-secondary small"
                  data-i18n="rico_en_proteínas_y_omega-3_ideal_como_almuerzo_rápido_y_sal">Rico en proteínas y omega-3,
                  ideal como almuerzo rápido y saludable.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Equivalencias -->
    <section class="equivalences">
      <div class="container text-center">
        <h2 id="equivalences-title" data-i18n="equivalences_title">Equivalencias de Alimentos</h2>
        <p id="equivalences-sub" class="text-secondary mb-4" data-i18n="equivalences_sub">Comprende cómo sustituir
          alimentos sin perder el equilibrio nutricional.</p>

        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead>
              <tr>
                <th data-i18n="alimento_base">Alimento Base</th>
                <th data-i18n="equivalencia">Equivalencia</th>
                <th data-i18n="valor_nutricional_aproximado">Valor Nutricional Aproximado</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td data-i18n="1_taza_de_arroz_cocido">1 taza de arroz cocido</td>
                <td data-i18n="1_taza_de_quinoa_cocida">1 taza de quinoa cocida</td>
                <td data-i18n="similar_en_calorías_más_proteína_y_fibra">Similar en calorías, más proteína y fibra</td>
              </tr>
              <tr>
                <td data-i18n="100g_de_carne_magra">100g de carne magra</td>
                <td data-i18n="100g_de_pollo_o_tofu_firme">100g de pollo o tofu firme</td>
                <td data-i18n="misma_proteína_menos_grasa_saturada">Misma proteína, menos grasa saturada</td>
              </tr>
              <tr>
                <td data-i18n="1_yogurt_natural">1 yogurt natural</td>
                <td data-i18n="1_yogurt_griego_sin_azúcar">1 yogurt griego sin azúcar</td>
                <td data-i18n="mayor_proteína_menor_azúcar">Mayor proteína, menor azúcar</td>
              </tr>
              <tr>
                <td data-i18n="1_cucharada_de_mantequilla">1 cucharada de mantequilla</td>
                <td data-i18n="1_cucharada_de_aguacate_triturado">1 cucharada de aguacate triturado</td>
                <td data-i18n="grasa_más_saludable_monoinsaturada">Grasa más saludable (monoinsaturada)</td>
              </tr>
              <tr>
                <td data-i18n="1_pan_blanco">1 pan blanco</td>
                <td data-i18n="1_pan_integral_o_de_centeno">1 pan integral o de centeno</td>
                <td data-i18n="más_fibra_y_saciedad">Más fibra y saciedad</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <footer>
      <p id="footer-text">© 2025 AI Fitness | Nutrición Inteligente y Educación Alimentaria</p>
    </footer>
    <script src="/static/js/lang.js"></script>

    <script>
      function toggleMealDetails(element) { const details = element.nextElementSibling; const icon = element.querySelector('i'); const isHidden = details.style.display === 'none' || details.style.display === ''; details.style.display = isHidden ? 'block' : 'none'; if (icon) { icon.classList.toggle('fa-chevron-down', !isHidden); icon.classList.toggle('fa-chevron-up', isHidden); } } function addNewMeal() { if (window.showAlertModal) { window.showAlertModal("Pronto", "Funcionalidad para agregar comida próximamente", "warning"); return; } alert('Funcionalidad para agregar comida próximamente'); }
    </script>
    <script src="/static/js/lang.js">
    </script>
    <script src="/static/js/session_nav.js">
    </script>
    <script src="/static/js/meal_planner.js">
    </script>
    <script>
      (function () {
        const msg = document.getElementById('nutriMsg');
        const btn = document.getElementById('btnGenMeals');
        const container = document.getElementById('mealsContainer');
        const btnSave = document.getElementById('btnSaveMealPlan');
        if (!btn) return;

        // Oculta ejemplos estáticos del template original para evitar confusión
        function hideSampleCards() {
          try {
            const cards = document.querySelectorAll('.daily-plan .meal-card');
            cards.forEach(card => {
              if (!container.contains(card)) {
                card.style.display = 'none';
              }
            });
          } catch (e) { /* ignore */ }
        }

        function resolveUserId(inputVal) {
          const typed = (inputVal || '').trim();
          try {
            const raw = localStorage.getItem('ai_fitness_user');
            if (raw) {
              const u = JSON.parse(raw);
              const loggedId = String(u.user_id || u._id || '').trim();
              const uname = (u.username || '').trim();
              const email = (u.email || '').trim().toLowerCase();
              if (!typed || typed === uname || typed.toLowerCase() === email) {
                return loggedId || typed;
              }
            }
          } catch (e) { }
          return typed;
        }

        function renderMeals(data, showSave = true) {
          hideSampleCards();
          container.innerHTML = '';
          const out = data.output || {};
          const meals = out.meals || [];

          // Calculate totals from items to ensure consistency
          let dailySumKcal = 0;

          // Prepare meal elements
          const mealElements = meals.map(m => {
            const card = document.createElement('div');
            card.className = 'meal-card';

            const header = document.createElement('div');
            header.className = 'meal-header';
            header.onclick = function () { toggleMealDetails(this); };

            const details = document.createElement('div'); details.className = 'meal-details'; details.style.display = 'none';
            const ul = document.createElement('ul'); ul.className = 'nutrition-list list-group list-group-flush';

            let mealKcalSum = 0;
            let mealP = 0, mealC = 0, mealF = 0;

            // Render items and accumulate sums
            (m.items || []).forEach(it => {
              const li = document.createElement('li');
              li.className = 'list-group-item d-flex justify-content-between align-items-center bg-transparent';

              const iMacros = it.macros || {};
              const iP = Number(iMacros.p ?? iMacros.protein ?? 0);
              const iC = Number(iMacros.c ?? iMacros.carbs ?? 0);
              const iF = Number(iMacros.f ?? iMacros.fat ?? 0);
              const iKcal = Number(it.kcal || 0);

              mealKcalSum += iKcal;
              mealP += iP;
              mealC += iC;
              mealF += iF;

              li.innerHTML = `
                <div>
                  <strong>${it.food || ''}</strong>
                  <div class="text-muted small">${it.qty || ''}</div>
                </div>
                <div class="text-end small">
                  <span class="text-primary">${iKcal} kcal</span>
                  <div class="text-secondary" style="font-size:0.8rem">P:${iP} C:${iC} G:${iF}</div>
                </div>
              `;
              ul.appendChild(li);
            });

            // Fallback to meal-level values if present and non-zero/valid, otherwise use calculated sums
            const displayKcal = (m.kcal != null && m.kcal !== '-') ? m.kcal : mealKcalSum;

            // Only use calculated macros if meal.macros is missing or empty
            const mac = m.macros || {};
            const valC = (mac.c ?? mac.carbs) != null ? (mac.c ?? mac.carbs) : mealC;
            const valP = (mac.p ?? mac.protein) != null ? (mac.p ?? mac.protein) : mealP;
            const valF = (mac.f ?? mac.fat) != null ? (mac.f ?? mac.fat) : mealF;

            dailySumKcal += Number(displayKcal || 0);

            const h = document.createElement('h4'); h.className = 'meal-title'; h.textContent = m.name || 'Comida';
            const span = document.createElement('span'); span.textContent = `Calorías totales: ${displayKcal} kcal`;
            const ico = document.createElement('i'); ico.className = 'fas fa-chevron-down';
            header.appendChild(h); header.appendChild(span); header.appendChild(ico);

            const p = document.createElement('div');
            p.className = 'p-3 border-top';
            p.innerHTML = `<i class="fas fa-chart-pie text-secondary me-2"></i>Macronutrientes: <strong>Carbohidratos ${valC}g</strong>, <strong>Proteína ${valP}g</strong>, <strong>Grasa ${valF}g</strong>`;

            details.appendChild(ul); details.appendChild(p);
            card.appendChild(header); card.appendChild(details);

            return card;
          });

          // Display Daily Total
          const targetTotal = out.total_kcal;
          const totalEl = document.createElement('div');
          totalEl.className = 'mb-3 text-white h5';
          totalEl.innerHTML = `Total del día (Plan): <strong>${dailySumKcal} kcal</strong> <span class="text-secondary small fw-normal">(Objetivo: ${targetTotal || '-'})</span>`;
          container.appendChild(totalEl);

          // Append all cards
          mealElements.forEach(c => container.appendChild(c));

          const tips = out.tips || [];
          if (tips.length) {
            const tipsBox = document.createElement('div');
            tipsBox.className = 'mt-3 text-secondary';
            tipsBox.innerHTML = `<strong>Consejos:</strong> ${tips.join(' · ')}`;
            container.appendChild(tipsBox);
          }
          if (meals.length && showSave) { btnSave.style.display = 'inline-block'; btnSave.dataset.payload = JSON.stringify(data); }
        }

        async function generate() {
          const userInput = document.getElementById('nutriUserId');
          const mealsSel = document.getElementById('nutriMeals');
          const prefs = document.getElementById('nutriPrefs').value.trim();
          const exclude = document.getElementById('nutriExclude').value.trim();
          const cuisine = document.getElementById('nutriCuisine').value.trim();
          const uid = resolveUserId(userInput.value);
          if (!uid) { msg.textContent = 'Ingresa un user_id'; return; }
          msg.textContent = 'Generando plan de comidas...';
          btnSave.style.display = 'none';
          try {
            const params = new URLSearchParams();
            params.set('meals', mealsSel.value);
            if (prefs) params.set('prefs', prefs);
            if (exclude) params.set('exclude', exclude);
            if (cuisine) params.set('cuisine', cuisine);
            const resp = await fetch(`/ai/nutrition/plan/${encodeURIComponent(uid)}?${params.toString()}`);
            if (!resp.ok) {
              const err = await resp.json().catch(() => ({ error: 'Error desconocido' }));
              throw new Error(err.error || `HTTP ${resp.status}`);
            }
            const data = await resp.json();
            renderMeals(data, true);
            msg.textContent = '';
          } catch (e) {
            msg.textContent = `No se pudo generar el plan: ${e.message}`;
          }
        }

        btn.addEventListener('click', generate);
        btnSave.addEventListener('click', async () => {
          const payloadStr = btnSave.dataset.payload || '';
          if (!payloadStr) { return; }
          try {
            const data = JSON.parse(payloadStr);
            const saveBody = { user_id: data.input?.user_id, backend: data.backend, input: data.input, output: data.output };
            const resp = await fetch('/meal_plans/save', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(saveBody) });
            if (!resp.ok) { const err = await resp.json().catch(() => ({ error: 'Error desconocido' })); throw new Error(err.error || `HTTP ${resp.status}`); }
            const resj = await resp.json();
            msg.textContent = 'Plan de nutricion guardado y activado';
            btnSave.style.display = 'none';
          } catch (e) { msg.textContent = `No se pudo guardar el plan: ${e.message}`; }
        });

        async function loadActive() {
          try {
            const uid = resolveUserId(document.getElementById('nutriUserId').value);
            if (!uid) { msg.textContent = 'Ingresa un user_id'; return; }
            const resp = await fetch(`/meal_plans/${encodeURIComponent(uid)}/active`);
            if (!resp.ok) { msg.textContent = 'No cuenta con plan de nutrición activo'; container.innerHTML = ''; btnSave.style.display = 'none'; return; }
            const doc = await resp.json();
            renderMeals({ backend: doc.backend, input: doc.input, output: doc.output }, false);
            msg.textContent = 'Plan de nutrición activo cargado';
          } catch (e) { msg.textContent = `Error al cargar plan activo: ${e.message}`; }
        }

        window.addEventListener('DOMContentLoaded', () => {
          hideSampleCards();
          try {
            const raw = localStorage.getItem('ai_fitness_user');
            if (raw) {
              const u = JSON.parse(raw);
              const display = (u.username || '').trim();
              if (display) { document.getElementById('nutriUserId').value = display; }
            }
          } catch (e) { }
          loadActive();
        });
      })();
    </script>

    <div id="appAlertModal" class="alert-modal-backdrop">
      <div class="alert-modal-card">
        <div id="appAlertTitle" class="alert-title"></div>
        <div id="appAlertMessage" class="alert-message"></div>
        <div class="alert-modal-actions">
          <button id="appAlertCancel" class="btn btn-outline-secondary">Cancelar</button>
          <button id="appAlertConfirm" class="btn btn-outline-danger">Confirmar</button>
        </div>
      </div>
    </div>

    <script>
      const appAlertModal = document.getElementById("appAlertModal");
      const appAlertTitle = document.getElementById("appAlertTitle");
      const appAlertMessage = document.getElementById("appAlertMessage");
      const appAlertCancel = document.getElementById("appAlertCancel");
      const appAlertConfirm = document.getElementById("appAlertConfirm");
      let appAlertResolve = null;

      const applyAlertTone = (tone) => {
        appAlertTitle.classList.remove("alert-tone-warning", "alert-tone-danger", "alert-tone-success");
        if (tone === "warning") appAlertTitle.classList.add("alert-tone-warning");
        if (tone === "danger") appAlertTitle.classList.add("alert-tone-danger");
        if (tone === "success") appAlertTitle.classList.add("alert-tone-success");
      };

      const showAlertModal = (title, message, tone = "warning") => {
        if (!appAlertModal) {
          alert(message || title || "Aviso");
          return Promise.resolve(true);
        }
        appAlertTitle.textContent = title || "Aviso";
        appAlertMessage.textContent = message || "";
        appAlertCancel.style.display = "none";
        appAlertConfirm.textContent = "Cerrar";
        appAlertConfirm.className = "btn btn-outline-light";
        applyAlertTone(tone);
        appAlertModal.classList.add("show");
        return new Promise(resolve => {
          appAlertResolve = resolve;
        });
      };

      const showConfirmModal = (title, message, tone = "danger") => {
        if (!appAlertModal) {
          return Promise.resolve(confirm(message || title || "Confirmar"));
        }
        appAlertTitle.textContent = title || "Confirmar";
        appAlertMessage.textContent = message || "";
        appAlertCancel.style.display = "inline-flex";
        appAlertConfirm.textContent = "Confirmar";
        appAlertConfirm.className = tone === "danger" ? "btn btn-outline-danger" : "btn btn-outline-success";
        applyAlertTone(tone);
        appAlertModal.classList.add("show");
        return new Promise(resolve => {
          appAlertResolve = resolve;
        });
      };

      const closeAlertModal = (result) => {
        appAlertModal.classList.remove("show");
        if (appAlertResolve) appAlertResolve(result);
        appAlertResolve = null;
      };

      appAlertCancel?.addEventListener("click", () => closeAlertModal(false));
      appAlertConfirm?.addEventListener("click", () => closeAlertModal(true));
      appAlertModal?.addEventListener("click", (event) => {
        if (event.target === appAlertModal) closeAlertModal(false);
      });

      window.showAlertModal = showAlertModal;
      window.showConfirmModal = showConfirmModal;
    </script>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
