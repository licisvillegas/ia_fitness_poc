<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>
    Synapse Fit | Nutrició³n Inteligente
  </title>
  <!-- Bootstrap + Tipografóƒ­a -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&amp;display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />
  <link href="/static/css/theme.css" rel="stylesheet">
  <link href="/static/css/sidebar.css" rel="stylesheet">
  <link href="/static/css/loader.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg-body);
      color: var(--text-main);
      overflow-x: hidden;
    }

    /* Navbar */
    .navbar {
      background-color: var(--bg-panel);
      border-bottom: 1px solid var(--border-color);
    }

    .navbar-brand {
      color: var(--primary) !important;
      font-weight: 700;
    }

    .navbar a {
      color: var(--text-main) !important;
    }

    /* Hero Section */
    .hero {
      position: relative;
      background: linear-gradient(to right, rgba(0, 0, 0, 0.6), rgba(37, 99, 235, 0.25));
      background-color: var(--bg-body);
      /* fallback */
      height: 90vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: var(--text-main);
      /* Always white over video/image */
      overflow: hidden;
    }

    /* Video background placed absolutely behind hero content */
    .hero-video {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      height: 100%;
      transform: translate(-50%, -50%);
      object-fit: cover;
      z-index: 0;
      pointer-events: none;
    }

    /* Overlay so text remains readable */
    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to right, rgba(0, 0, 0, 0.45), rgba(37, 99, 235, 0.18));
      z-index: 1;
    }

    /* Ensure container content sits above video */
    .hero .container {
      position: relative;
      z-index: 2;
    }

    /* Hide video on small screens to save bandwidth */
    @media (max-width: 767px) {
      .hero-video {
        display: none;
      }

      .hero {
        background-image: url('/static/images/IMG_1571.jpg');
        background-size: cover;
        background-position: center;
      }
    }

    /* Respect user preference to reduce motion */
    @media (prefers-reduced-motion: reduce) {
      .hero-video {
        display: none;
      }

      .hero {
        background-image: url('/static/images/IMG_1571.jpg');
        background-size: cover;
        background-position: center;
      }
    }

    .hero h1 {
      font-size: 3rem;
      font-weight: 700;
      color: #ffffff !important;
    }

    .hero p {
      color: #ffffff !important;
    }

    /* Daily Plan */
    .daily-plan {
      padding: 3rem 0 0 0;
    }

    /* Meal Cards */
    .meal-card {
      background-color: var(--bg-card);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      margin-bottom: 1rem;
      border: 1px solid var(--border-color);
    }

    .meal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.85rem 1rem;
      background-color: var(--bg-panel);
      cursor: pointer;
      border-bottom: 1px solid var(--border-color);
    }

    .meal-header:hover {
      background-color: var(--bg-card-hover);
    }

    .meal-title {
      margin: 0;
      font-size: 1.1rem;
      color: var(--text-main);
    }

    .nutrition-list {
      list-style: none;
      margin: 0;
      padding: 0.75rem 1rem;
    }

    .meal-details p {
      margin: 0 1rem 1rem;
      color: var(--text-secondary);
    }

    /* Recipes */
    .recipes {
      padding: 4rem 0;
    }

    .recipe-card {
      background-color: var(--bg-card);
      border-radius: 15px;
      overflow: hidden;
      transition: 0.3s;
      height: 100%;
      border: 1px solid var(--border-color);
    }

    .recipe-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }

    .recipe-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 20px rgba(37, 99, 235, 0.3);
      background-color: var(--bg-card-hover);
    }

    .recipe-card h5 {
      color: var(--primary);
    }

    /* Equivalences */
    .equivalences {
      background-color: var(--bg-panel);
      padding: 4rem 0;
    }

    .equivalences h2 {
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 2rem;
    }

    .table {
      color: var(--text-main);
      background-color: transparent;
    }

    .table thead {
      color: var(--primary);
      border-color: var(--border-color);
    }

    .table-striped>tbody>tr:nth-of-type(odd)>* {
      background-color: transparent !important;
      /* Let bg-card handle it via row style */
      box-shadow: inset 0 0 0 9999px var(--bg-input);
      /* Bootstrap way to stripe */
      color: var(--text-main);
    }

    .table-striped>tbody>tr:nth-of-type(even)>* {
      background-color: transparent !important;
      color: var(--text-main);
    }

    .table> :not(caption)>*>* {
      background-color: transparent;
      /* Reset bootstrap defaults */
      color: var(--text-main);
      border-color: var(--border-color);
    }

    /* Footer */
    footer {
      background-color: var(--bg-panel);
      color: var(--text-muted);
      text-align: center;
      padding: 1rem 0;
      margin-top: 3rem;
      border-top: 1px solid var(--border-color);
    }

    @keyframes alertSlideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .alert-modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 3000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .alert-modal-backdrop.show {
      display: flex;
    }

    .alert-modal-card {
      width: 100%;
      max-width: 420px;
      background: var(--bg-body);
      border: 1px solid var(--border-color);
      border-radius: 18px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
      padding: 1.5rem;
      color: var(--text-main);
      animation: alertSlideIn 0.25s ease-out;
    }

    .alert-modal-card .alert-title {
      font-weight: 700;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .alert-modal-card .alert-message {
      color: var(--text-muted);
      margin-bottom: 1.25rem;
      line-height: 1.4;
    }

    .alert-modal-actions {
      display: flex;
      gap: 0.75rem;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    .alert-tone-warning {
      color: #ff9d00;
    }

    .alert-tone-danger {
      color: #ff5c5c;
    }

    .alert-tone-success {
      color: #00ff9d;
    }

    @media print {

      /* Hide all non-essential elements */
      .sidebar,
      .navbar,
      .hero,
      .recipes,
      .equivalences,
      footer,
      #daily-plan-controls,
      #btnGenMeals,
      #btnSaveMealPlan,
      .main-content>.container>h3>button {
        display: none !important;
      }

      /* Adjust Main Layout for Print */
      body,
      .main-content {
        margin: 0 !important;
        padding: 0 !important;
        background-color: var(--text-main) !important;
        color: black !important;
        width: 100% !important;
        height: auto !important;
        overflow: visible !important;
      }

      /* Specific visibility for the plan section */
      .daily-plan {
        padding: 0 !important;
        display: block !important;
      }

      .daily-plan .container {
        max-width: 100% !important;
        width: 100% !important;
        margin: 0 !important;
        padding: 20px !important;
      }

      /* Ensure the meals container and its children are visible and styled */
      #mealsContainer {
        display: block !important;
      }

      /* Style Meal Cards for Print */
      .meal-card {
        break-inside: avoid;
        border: 1px solid #ccc !important;
        box-shadow: none !important;
        background-color: var(--text-main) !important;
        margin-bottom: 20px !important;
        page-break-inside: avoid;
      }

      .meal-header {
        background-color: var(--bg-input) !important;
        color: black !important;
        border-bottom: 1px solid #ddd !important;
      }

      .meal-title {
        color: black !important;
      }

      .meal-header span {
        color: #333 !important;
      }

      .nutrition-list li {
        color: black !important;
        border-color: var(--text-muted) !important;
      }

      .nutrition-list li strong {
        color: #000 !important;
      }

      .nutrition-list li .small {
        color: #555 !important;
      }

      .meal-details {
        display: block !important;
        /* Force expand details */
      }

      .meal-details p {
        color: #333 !important;
      }

      /* Hide icons that don't make sense in print */
      .meal-header i,
      .meal-details i {
        display: none !important;
      }

      /* Ensure total text is visible */
      .h5.text-white {
        color: black !important;
        font-size: 1.2rem !important;
        margin-bottom: 1.5rem !important;
        border-bottom: 2px solid #000;
        padding-bottom: 10px;
      }

      /* Header adjustments */
      h3.text-center {
        text-align: left !important;
        font-size: 2rem !important;
        border-bottom: 2px solid #000;
        padding-bottom: 10px;
        margin-bottom: 20px !important;
        color: #000 !important;
      }

      /* Remove background from list items */
      .list-group-item {
        background-color: transparent !important;
      }
    }
  </style>
</head>

<body>
  <!-- Estructura general: hero, generador AI, recetas y equivalencias. -->
  <!-- Barra de navegacion -->
  <!-- Barra de navegacion -->
  <input type="hidden" id="current_user_id" value="{{ current_user.user_id if current_user else '' }}">
  {% include 'components/sidebar.html' %}
  {% include 'components/loader.html' %}
  <div class="main-content">
    <!-- Seccion hero -->
    <!-- Hero con video y descripcion -->
    <section class="hero">
      <!-- Video de fondo (usa poster si falta el video) -->
      <video autoplay="" class="hero-video" loop="" muted="" playsinline="" poster="/static/images/IMG_1571.jpg">
        <source src="/static/videos/B6C7D05D-8000-462D-89CE-BE94145A4123.MP4" type="video/mp4" />
        <!-- Si no hay soporte de video, se muestra el poster/fondo -->
      </video>
      <div aria-hidden="true" class="hero-overlay">
      </div>
      <div class="container">
        <h1 id="nutrition-hero-title">
          Nutrició³n Inteligente para un Rendimiento ó“ptimo
        </h1>
        <p class="lead mt-3" id="nutrition-hero-p">
          Descubre recetas saludables y aprende a equilibrar tus alimentos con equivalencias precisas.
        </p>
      </div>
    </section>

    <!-- Generador de plan diario (AI) -->
    <section class="daily-plan">
      <div class="container mt-4">
        <h3 class="text-center mb-4 text-white">Plan de Nutrición (AI)</h3>

        <!-- Resumen y control de impresion -->
        <div id="nutritionPlanSummary" class="d-flex justify-content-between align-items-center mb-3 px-1"
          style="display:none;">
          <div id="nutritionPlanTotal" class="h5 text-white mb-0"></div>
          <button class="btn btn-outline-primary btn-sm" onclick="window.print()">
            <i class="fas fa-print me-2"></i>Imprimir
          </button>
        </div>

        {% if current_user_role == 'admin' %}
        <div class="text-center mb-3" id="daily-plan-controls" style="display:none;">
          <div class="input-group justify-content-center" style="max-width:820px;margin:0 auto;gap:8px;">
            <input id="nutriUserId" type="text" class="form-control text-center"
              placeholder="user_id o deja vacó­o para usar el del login" autocomplete="off" autocorrect="off"
              autocapitalize="off" spellcheck="false">
            <select id="nutriMeals" class="form-select" style="max-width:300px;">
              <option value="3">3 comidas (Simplicidad / Ayuno Intermitente)</option>
              <option value="4">4 comidas (Estilo de vida oficina / Mantenimiento)</option>
              <option value="5">5 comidas (Control de ansiedad / Estándar fitness)</option>
              <option value="6" selected>6 comidas (Ganancia muscular / Alto rendimiento)</option>
            </select>
            <input id="nutriPrefs" type="text" class="form-control" placeholder="preferencias (opcional)">
            <input id="nutriExclude" type="text" class="form-control" placeholder="exclusiones (opcional)">
            <button id="btnGenMeals" class="btn btn-primary">Generar plan</button>
            <button id="btnSaveMealPlan" class="btn btn-success" style="display:none;">
              Guardar y activar
            </button>
          </div>
          <div class="mt-2">
            <input id="nutriCuisine" type="text" class="form-control" style="max-width:820px;margin:0 auto;"
              placeholder="cocina preferida / notas (opcional)">
          </div>
          <div id="nutriMsg" class="mt-2 text-info"></div>
        </div>
        <script>
          (function () {
            try {
              if (sessionStorage.getItem('admin_unlocked') === 'true') {
                const controls = document.getElementById('daily-plan-controls');
                if (controls) controls.style.display = 'block';
              }
            } catch (e) { }
          })();
        </script>
        {% endif %}
        <div id="mealsContainer"></div>
      </div>
    </section>

    <!-- Recetas -->
    <!-- Recetas recomendadas -->
    <!-- Listado de recetas sugeridas -->
    <section class="recipes">
      <div class="container text-center mb-5">
        <h2 id="recipes-title" class="fw-bold text-theme">Recetas Fitness</h2>
        <p id="recipes-sub" class="text-secondary">Fáciles, nutritivas y llenas de energó­a para acompaó±ar tus
          entrenamientos.</p>
      </div>

      <div class="container">
        <div class="row g-4">
          <div class="col-md-4">
            <div class="recipe-card">
              <img
                src="https://storage.googleapis.com/fitia_public_images/recipes%2FGR-R-V-00006049_k7e35yjcue169n3bjafdcxao_large.jpg"
                alt="Avena proteica">
              <div class="p-3">
                <h5 data-i18n="avena_proteica">Avena Proteica</h5>
                <p class="text-secondary small"
                  data-i18n="avena_proteó­na_en_polvo_banana_y_canela_ideal_para_comenzar_">Avena, proteó­na en polvo,
                  banana y canela. Ideal para comenzar el dó­a lleno de energó­a.</p>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="recipe-card">
              <img src="https://storage.googleapis.com/avena-recipes-v2/2019/10/1571783768842.jpeg"
                alt="Bowl de pollo y quinoa">
              <div class="p-3">
                <h5 data-i18n="bowl_de_pollo_y_quinoa">Bowl de Pollo y Quinoa</h5>
                <p class="text-secondary small"
                  data-i18n="combinació³n_equilibrada_de_proteó­nas_granos_y_vegetales_para">Combinació³n equilibrada de
                  proteó­nas, granos y vegetales para recuperació³n muscular.</p>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="recipe-card">
              <img src="https://zenu.com.co/wp-content/uploads/2023/12/wrap-de-atun-zenu.jpeg" alt="Wrap de atóºn">
              <div class="p-3">
                <h5 data-i18n="wrap_de_atóºn">Wrap de Atóºn</h5>
                <p class="text-secondary small"
                  data-i18n="rico_en_proteó­nas_y_omega-3_ideal_como_almuerzo_rápido_y_sal">Rico en proteó­nas y
                  omega-3,
                  ideal como almuerzo rápido y saludable.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Equivalencias -->
    <!-- Tabla de equivalencias -->
    <!-- Equivalencias y swaps -->
    <section class="equivalences">
      <div class="container text-center">
        <h2 id="equivalences-title" data-i18n="equivalences_title">Equivalencias de Alimentos</h2>
        <p id="equivalences-sub" class="text-secondary mb-4" data-i18n="equivalences_sub">Comprende có³mo sustituir
          alimentos sin perder el equilibrio nutricional.</p>

        <div class="table-responsive">
          <table class="table table-striped align-middle">
            <thead>
              <tr>
                <th data-i18n="alimento_base">Alimento Base</th>
                <th data-i18n="equivalencia">Equivalencia</th>
                <th data-i18n="valor_nutricional_aproximado">Valor Nutricional Aproximado</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td data-i18n="1_taza_de_arroz_cocido">1 taza de arroz cocido</td>
                <td data-i18n="1_taza_de_quinoa_cocida">1 taza de quinoa cocida</td>
                <td data-i18n="similar_en_caloró­as_más_proteó­na_y_fibra">Similar en caloró­as, más proteó­na y fibra
                </td>
              </tr>
              <tr>
                <td data-i18n="100g_de_carne_magra">100g de carne magra</td>
                <td data-i18n="100g_de_pollo_o_tofu_firme">100g de pollo o tofu firme</td>
                <td data-i18n="misma_proteó­na_menos_grasa_saturada">Misma proteó­na, menos grasa saturada</td>
              </tr>
              <tr>
                <td data-i18n="1_yogurt_natural">1 yogurt natural</td>
                <td data-i18n="1_yogurt_griego_sin_azóºcar">1 yogurt griego sin azóºcar</td>
                <td data-i18n="mayor_proteó­na_menor_azóºcar">Mayor proteó­na, menor azóºcar</td>
              </tr>
              <tr>
                <td data-i18n="1_cucharada_de_mantequilla">1 cucharada de mantequilla</td>
                <td data-i18n="1_cucharada_de_aguacate_triturado">1 cucharada de aguacate triturado</td>
                <td data-i18n="grasa_más_saludable_monoinsaturada">Grasa más saludable (monoinsaturada)</td>
              </tr>
              <tr>
                <td data-i18n="1_pan_blanco">1 pan blanco</td>
                <td data-i18n="1_pan_integral_o_de_centeno">1 pan integral o de centeno</td>
                <td data-i18n="más_fibra_y_saciedad">Más fibra y saciedad</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <footer>
      <p id="footer-text">© 2025 Synapse Fit | Nutrició³n Inteligente y Educació³n Alimentaria</p>
      <small class="text-secondary d-block">v. beta 1.1.0.2</small>
    </footer>
    <script src="/static/js/lang.js"></script>
    <script src="/static/js/theme.js"></script>

    <script>
      function toggleMealDetails(element) { const details = element.nextElementSibling; const icon = element.querySelector('i'); const isHidden = details.style.display === 'none' || details.style.display === ''; details.style.display = isHidden ? 'block' : 'none'; if (icon) { icon.classList.toggle('fa-chevron-down', !isHidden); icon.classList.toggle('fa-chevron-up', isHidden); } } function addNewMeal() { if (window.showAlertModal) { window.showAlertModal("Pronto", "Funcionalidad para agregar comida pró³ximamente", "warning"); return; } alert('Funcionalidad para agregar comida pró³ximamente'); }
    </script>
    <script src="/static/js/lang.js">
    </script>
    <script src="/static/js/session_nav.js">
    </script>
    <script src="/static/js/meal_planner.js">
    </script>


    <div id="appAlertModal" class="alert-modal-backdrop">
      <div class="alert-modal-card">
        <div id="appAlertTitle" class="alert-title"></div>
        <div id="appAlertMessage" class="alert-message"></div>
        <div class="alert-modal-actions">
          <button id="appAlertCancel" class="btn btn-outline-secondary">Cancelar</button>
          <button id="appAlertConfirm" class="btn btn-outline-danger">Confirmar</button>
        </div>
      </div>
    </div>

    <script>
      const appAlertModal = document.getElementById("appAlertModal");
      const appAlertTitle = document.getElementById("appAlertTitle");
      const appAlertMessage = document.getElementById("appAlertMessage");
      const appAlertCancel = document.getElementById("appAlertCancel");
      const appAlertConfirm = document.getElementById("appAlertConfirm");
      let appAlertResolve = null;

      const applyAlertTone = (tone) => {
        appAlertTitle.classList.remove("alert-tone-warning", "alert-tone-danger", "alert-tone-success");
        if (tone === "warning") appAlertTitle.classList.add("alert-tone-warning");
        if (tone === "danger") appAlertTitle.classList.add("alert-tone-danger");
        if (tone === "success") appAlertTitle.classList.add("alert-tone-success");
      };

      const showAlertModal = (title, message, tone = "warning") => {
        if (!appAlertModal) {
          alert(message || title || "Aviso");
          return Promise.resolve(true);
        }
        appAlertTitle.textContent = title || "Aviso";
        appAlertMessage.textContent = message || "";
        appAlertCancel.style.display = "none";
        appAlertConfirm.textContent = "Cerrar";
        appAlertConfirm.className = "btn btn-outline-light";
        applyAlertTone(tone);
        appAlertModal.classList.add("show");
        return new Promise(resolve => {
          appAlertResolve = resolve;
        });
      };

      const showConfirmModal = (title, message, tone = "danger") => {
        if (!appAlertModal) {
          return Promise.resolve(confirm(message || title || "Confirmar"));
        }
        appAlertTitle.textContent = title || "Confirmar";
        appAlertMessage.textContent = message || "";
        appAlertCancel.style.display = "inline-flex";
        appAlertConfirm.textContent = "Confirmar";
        appAlertConfirm.className = tone === "danger" ? "btn btn-outline-danger" : "btn btn-outline-success";
        applyAlertTone(tone);
        appAlertModal.classList.add("show");
        return new Promise(resolve => {
          appAlertResolve = resolve;
        });
      };

      const closeAlertModal = (result) => {
        appAlertModal.classList.remove("show");
        if (appAlertResolve) appAlertResolve(result);
        appAlertResolve = null;
      };

      appAlertCancel?.addEventListener("click", () => closeAlertModal(false));
      appAlertConfirm?.addEventListener("click", () => closeAlertModal(true));
      appAlertModal?.addEventListener("click", (event) => {
        if (event.target === appAlertModal) closeAlertModal(false);
      });

      window.showAlertModal = showAlertModal;
      window.showConfirmModal = showConfirmModal;
    </script>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/js/loader.js"></script>
</body>

</html>