<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Synapse Fit | Nutrición Inteligente</title>

  <!-- External CDNs -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&amp;display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />

  <!-- Base Styles -->
  <link href="/static/css/theme.css" rel="stylesheet">
  <link href="/static/css/sidebar.css" rel="stylesheet">
  <link href="/static/css/loader.css" rel="stylesheet">

  <!-- Page Specific Styles -->
  <link href="/static/css/nutrition.css" rel="stylesheet">
  <link href="/static/css/food_exchanges.css" rel="stylesheet">
</head>

<body>
  <!-- Estructura general: hero, generador AI, recetas y equivalencias. -->
  <input type="hidden" id="current_user_id" value="{{ current_user.user_id if current_user else '' }}">

  {% include 'components/sidebar.html' %}
  {% include 'components/loader.html' %}

  <div class="main-content">
    <!-- Sección Hero -->
    <section class="hero">
      <img class="hero-video" src="/static/images/IMG_3664.jpeg" alt="Imagen destacada" />
      <div aria-hidden="true" class="hero-overlay"></div>
      <div class="container">
        <h1 id="nutrition-hero-title">Nutrición Inteligente para un Rendimiento Óptimo</h1>
        <p class="lead mt-3" id="nutrition-hero-p">
          Descubre recetas saludables y aprende a equilibrar tus alimentos con nuestro gestor inteligente.
        </p>
      </div>
    </section>

    <!-- Generador de plan diario (AI) -->
    <section class="daily-plan">
      <div class="container mt-4">
        <h3 class="text-center mb-4 text-white">Plan de Nutrición</h3>

        <!-- Resumen y control de impresión -->
        <div id="nutritionPlanSummary" class="d-flex justify-content-between align-items-center mb-3 px-1"
          style="display:none;">
          <div id="nutritionPlanTotal" class="h5 text-white mb-0"></div>
          <button class="btn btn-outline-primary btn-sm" onclick="window.print()">
            <i class="fas fa-print me-2"></i>Imprimir
          </button>
        </div>

        <div class="text-center mb-3" id="daily-plan-controls" style="display:none;"
          data-role="{{ 'admin' if current_user_role == 'admin' else 'user' }}">
          <div class="input-group justify-content-center" style="max-width:820px;margin:0 auto;gap:8px;">
            {% if current_user_role == 'admin' %}
            <input id="nutriUserId" type="text" class="form-control text-center"
              placeholder="user_id o deja vacío para usar el del login" autocomplete="off" autocorrect="off"
              autocapitalize="off" spellcheck="false">
            {% else %}
            <input id="nutriUserId" type="hidden" value="{{ current_user.user_id if current_user else '' }}">
            {% endif %}
            <select id="nutriMeals" class="form-select" style="max-width:300px;">
              <option value="3">3 comidas (Simplicidad / Ayuno Intermitente)</option>
              <option value="4">4 comidas (Estilo de vida oficina / Mantenimiento)</option>
              <option value="5">5 comidas (Control de ansiedad / Estándar fitness)</option>
              <option value="6" selected>6 comidas (Ganancia muscular / Alto rendimiento)</option>
            </select>
            {% if current_user_role == 'admin' %}
            <input id="nutriPrefs" type="text" class="form-control" placeholder="preferencias (opcional)">
            <input id="nutriExclude" type="text" class="form-control" placeholder="exclusiones (opcional)">
            {% endif %}
            <button id="btnGenMeals" class="btn btn-primary">Generar plan</button>
            <button id="btnSaveMealPlan" class="btn btn-success" style="display:none;">Guardar y activar</button>
          </div>
          {% if current_user_role == 'admin' %}
          <div class="mt-2">
            <input id="nutriCuisine" type="text" class="form-control" style="max-width:820px;margin:0 auto;"
              placeholder="cocina preferida / notas (opcional)">
          </div>
          {% endif %}
          <div id="nutriMsg" class="mt-2 text-info"></div>
        </div>

        <div id="mealsContainer"></div>
      </div>
    </section>

    <!-- Intercambios Interactivos (NUEVO) -->
    {% include 'components/food_exchanges.html' %}

    <!-- Recetas Recomendadas -->
    {% include 'components/nutrition_recipes.html' %}



    <footer>
      <p id="footer-text">© 2025 Synapse Fit | Nutrición Inteligente y Educación Alimentaria</p>
      <small class="text-secondary d-block">v. beta 1.1.0.6_10</small>
    </footer>

    <!-- Componente Global: Alert Modal -->
    {% include 'components/alert_modal.html' %}
  </div>

  <!-- External Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Global App Scripts -->
  <script src="/static/js/theme.js"></script>
  <script src="/static/js/lang.js"></script>
  <script src="/static/js/session_nav.js"></script>
  <script src="/static/js/loader.js"></script>
  <script src="/static/js/meal_planner.js"></script>
  <script src="/static/js/alert_modal.js"></script>

  <!-- Page Specific Scripts -->
  <script src="/static/js/nutrition_ui.js"></script>
  <script src="/static/js/food_exchanges.js"></script>
</body>

</html>