<!-- Modal Detalle Ejercicio (View Only) -->
<div class="modal fade" id="exerciseDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content bg-panel text-white border-cyber">
            <div class="modal-header border-secondary">
                <h5 class="modal-title text-cyber-green" id="exerciseDetailsTitle">Ejercicio</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-12">
                        <div class="exercise-modal-hero mb-3 position-relative rounded overflow-hidden"
                            style="height: 250px; background: #000;">
                            <img id="exerciseDetailsImage" src="" alt="Ejercicio"
                                style="width: 100%; height: 100%; object-fit: contain;">
                        </div>
                        <div class="d-flex flex-wrap gap-2 mb-3" id="exerciseDetailsBadges"></div>
                        <div class="small text-secondary mb-3" id="exerciseDetailsMeta"></div>
                        <div class="d-grid">
                            <button id="exerciseDetailsVideoBtn" type="button" class="btn btn-outline-danger d-none">
                                <i class="fab fa-youtube me-1"></i> Ver Video
                            </button>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="mb-0">
                            <label class="form-label text-secondary">Descripción / Notas Técnicas</label>
                            <div class="form-control bg-dark text-white border-secondary" style="min-height: 90px;"
                                id="exerciseDetailsDesc"></div>
                        </div>
                        <div class="mt-3">
                            <label class="form-label text-secondary">Sustitutos / Equivalentes</label>
                            <div class="bg-dark border border-secondary rounded p-2" style="min-height: 80px;">
                                <ul class="list-unstyled mb-0" id="exerciseDetailsSubs"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-info admin-only d-none" id="detailsEditBtn"
                    onclick="">Editar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Crear/Editar Ejercicio (Admin) -->
<div class="modal fade" id="exerciseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-panel text-white border-cyber">
            <div class="modal-header border-secondary">
                <h5 class="modal-title text-cyber-green">Ejercicio</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <form id="exerciseForm">
                    <input type="hidden" id="exId">

                    <!-- Basic Info & Taxonomy -->
                    <h6 class="text-cyber-blue border-bottom border-secondary pb-2 mb-3">Información Básica</h6>
                    <div class="row g-3 mb-4">

                        <div class="col-12">
                            <label class="form-label text-secondary small text-uppercase fw-bold">Nombre del Ejercicio
                                *</label>
                            <input type="text" class="form-control bg-dark text-white border-secondary" id="exName"
                                required placeholder="Ej. Press Banca Plano">
                        </div>
                        <div class="col-12">
                            <label class="form-label text-secondary small">Nombres Alternativos</label>
                            <input type="text" class="form-control bg-dark text-white border-secondary"
                                id="exAlternativeNames" placeholder="Separa con comas...">
                        </div>

                        <div class="col-md-4">
                            <label class="form-label text-secondary small">Sección</label>
                            <select class="form-select bg-dark text-white border-secondary" id="exSection">
                                <option value="">Selecciona...</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label text-secondary small">Grupo Muscular</label>
                            <select class="form-select bg-dark text-white border-secondary" id="exGroup" disabled>
                                <option value="">Selecciona...</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label text-secondary small">Músculo Específico</label>
                            <select class="form-select bg-dark text-white border-secondary" id="exMuscle" disabled>
                                <option value="">Selecciona...</option>
                            </select>
                        </div>
                    </div>

                    <!-- Technical Details -->
                    <h6 class="text-cyber-blue border-bottom border-secondary pb-2 mb-3">Detalles Técnicos</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <label class="form-label text-secondary small">Tipo de Registro</label>
                            <select class="form-select bg-dark text-white border-secondary" id="exType">
                                <option value="weight">Peso (Series x Reps)</option>
                                <option value="time">Tiempo (Duración)</option>
                                <option value="cardio">Cardio (Distancia/Tiempo)</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label text-secondary small">Nivel de Dificultad</label>
                            <select class="form-select bg-dark text-white border-secondary" id="exLevel">
                                <option value="">Sin definir</option>
                                <option value="Beginner">Principiante</option>
                                <option value="Intermediate">Intermedio</option>
                                <option value="Advanced">Avanzado</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label text-secondary small">Equipo Requerido</label>
                            <select class="form-select bg-dark text-white border-secondary" id="exEquipment" multiple
                                size="3">
                                <!-- Populated by JS -->
                            </select>
                            <div class="form-text text-muted" style="font-size: 0.7rem;">Mantén Ctrl para selección
                                múltiple</div>
                        </div>

                        <div class="col-md-3">
                            <label class="form-label text-secondary small">Patrón de Movimiento</label>
                            <select class="form-select bg-dark text-white border-secondary" id="exPattern">
                                <option value="">Sin definir</option>
                                <option value="Push">Empuje (Push)</option>
                                <option value="Pull">Jalón (Pull)</option>
                                <option value="Squat">Sentadilla (Squat)</option>
                                <option value="Hinge">Bisagra (Hinge)</option>
                                <option value="Carry">Transporte (Carry)</option>
                                <option value="Rotation">Rotación</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label text-secondary small">Plano de Movimiento</label>
                            <select class="form-select bg-dark text-white border-secondary" id="exPlane">
                                <option value="">Sin definir</option>
                                <option value="Vertical">Vertical</option>
                                <option value="Horizontal">Horizontal</option>
                                <option value="Sagittal">Sagital</option>
                                <option value="Frontal">Frontal</option>
                                <option value="Transversal">Transversal</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label text-secondary small">Músculo Primario (Texto)</label>
                            <input type="text" class="form-control bg-dark text-white border-secondary"
                                id="exPrimaryMuscle" placeholder="Ej. Dorsal Ancho">
                        </div>
                        <div class="col-md-3 d-flex align-items-center pt-4">
                            <div class="form-check form-switch w-100">
                                <input class="form-check-input" type="checkbox" id="exUnilateral">
                                <label class="form-check-label text-white" for="exUnilateral">¿Es Unilateral?</label>
                            </div>
                        </div>
                    </div>

                    <!-- Content & Media -->
                    <h6 class="text-cyber-blue border-bottom border-secondary pb-2 mb-3">Contenido y Multimedia</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <label class="form-label text-secondary small">Video URL (YouTube/MP4)</label>
                            <div class="input-group">
                                <span class="input-group-text bg-dark border-secondary text-secondary"><i
                                        class="fab fa-youtube"></i></span>
                                <input type="url" class="form-control bg-dark text-white border-secondary" id="exVideo"
                                    placeholder="https://...">
                            </div>
                        </div>
                        <div class="col-12">
                            <label class="form-label text-secondary small">Descripción y Notas Técnicas</label>
                            <textarea class="form-control bg-dark text-white border-secondary" id="exDescription"
                                rows="3" placeholder="Describe la técnica correcta..."></textarea>
                        </div>
                    </div>

                    <!-- Substitutes -->
                    <h6 class="text-cyber-blue border-bottom border-secondary pb-2 mb-3">Ejercicios Sustitutos</h6>
                    <div class="row g-3">
                        <div class="col-12">
                            <div class="input-group mb-2">
                                <span class="input-group-text bg-dark border-secondary text-secondary"><i
                                        class="fas fa-search"></i></span>
                                <input type="text" class="form-control bg-dark text-white border-secondary"
                                    id="subSearch" placeholder="Buscar ejercicios equivalentes...">
                            </div>
                            <div class="bg-input border border-secondary rounded p-2 custom-scrollbar"
                                style="max-height: 200px; overflow-y: auto;" id="substitutesContainer">
                                <!-- Populated JS -->
                            </div>
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-success" onclick="saveExercise()">Guardar Cambios</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Mensajes -->
<div class="modal fade" id="messageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-panel text-white border-cyber">
            <div class="modal-header border-secondary">
                <h5 class="modal-title text-cyber-green">Mensaje</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body"></div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" id="messageCancel"
                    data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-cyber-primary" id="messageConfirm">Confirmar</button>
                <button type="button" class="btn btn-cyber-primary" id="messageOk"
                    data-bs-dismiss="modal">Aceptar</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal Video -->
<div class="modal fade" id="videoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content bg-panel text-white border-cyber">
            <!-- Same Video Modal as others -->
            <div class="modal-header border-secondary">
                <h5 class="modal-title text-cyber-green">Video</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <div class="ratio ratio-16x9">
                    <iframe id="videoFrame" src="" title="Video ejercicio"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen></iframe>
                </div>
            </div>
        </div>
    </div>
</div>
